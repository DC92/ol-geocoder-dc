/*! OPENLAYERS ADAPTATION
 * Â© Dominique Cavailhez 2017
 * https://github.com/Dominique92/MyOl
 * Based on https://openlayers.org
 * This file has been generated by npm run build from the src/... sources
 * Please don't modify it : modify src/... & npm run build !
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OlGeocoder=e()}(this,(function(){"use strict";var t=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},e="propertychange";var i=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function s(t,e){return t>e?1:t<e?-1:0}function n(t,e,i){if(t[0]<=e)return 0;const s=t.length;if(e<=t[s-1])return s-1;if("function"==typeof i){for(let n=1;n<s;++n){const s=t[n];if(s===e)return n;if(s<e)return i(e,t[n-1],s)>0?n-1:n}return s-1}if(i>0){for(let i=1;i<s;++i)if(t[i]<e)return i-1;return s-1}if(i<0){for(let i=1;i<s;++i)if(t[i]<=e)return i;return s-1}for(let i=1;i<s;++i){if(t[i]==e)return i;if(t[i]<e)return t[i-1]-e<e-t[i]?i-1:i}return s-1}function r(t,e,i){for(;e<i;){const s=t[e];t[e]=t[i],t[i]=s,++e,--i}}function o(t,e){const i=Array.isArray(e)?e:[e],s=i.length;for(let e=0;e<s;e++)t[t.length]=i[e]}function a(t,e){const i=t.length;if(i!==e.length)return!1;for(let s=0;s<i;s++)if(t[s]!==e[s])return!1;return!0}function l(){return!0}function h(){}function c(t){for(const e in t)delete t[e]}function u(t){let e;for(e in t)return!1;return!e}var d=class extends i{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),s=i[t]||(i[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(e){const i="string"==typeof e,s=i?e:e.type,n=this.listeners_&&this.listeners_[s];if(!n)return;const r=i?new t(e):e;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});let l;s in o||(o[s]=0,a[s]=0),++o[s];for(let t=0,e=n.length;t<e;++t)if(l="handleEvent"in n[t]?n[t].handleEvent(r):n[t].call(this,r),!1===l||r.propagationStopped){l=!1;break}if(0==--o[s]){let t=a[s];for(delete a[s];t--;)this.removeEventListener(s,h);delete o[s]}return l}disposeInternal(){this.listeners_&&c(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(t,e){const i=this.listeners_&&this.listeners_[t];if(i){const s=i.indexOf(e);-1!==s&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[s]=h,++this.pendingRemovals_[t]):(i.splice(s,1),0===i.length&&delete this.listeners_[t]))}}},g="change",f="error",_="load";function m(t,e,i,s,n){if(s&&s!==t&&(i=i.bind(s)),n){const s=i;i=function(){t.removeEventListener(e,i),s.apply(this,arguments)}}const r={target:t,type:e,listener:i};return t.addEventListener(e,i),r}function p(t,e,i,s){return m(t,e,i,s,!0)}function x(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),c(t))}class y extends d{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(g)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,s=new Array(i);for(let n=0;n<i;++n)s[n]=m(this,t[n],e);return s}return m(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const s=t.length;i=new Array(s);for(let n=0;n<s;++n)i[n]=p(this,t[n],e)}else i=p(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)!function(t){if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)x(t[e]);else x(t)}(i);else if(Array.isArray(t))for(let i=0,s=t.length;i<s;++i)this.removeEventListener(t[i],e);else this.removeEventListener(t,e)}}y.prototype.on,y.prototype.once,y.prototype.un;var v=y;function S(){throw new Error("Unimplemented abstract method.")}let C=0;function R(t){return t.ol_uid||(t.ol_uid=String(++C))}class w extends t{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}var I=class extends v{constructor(t){super(),this.on,this.once,this.un,R(this),this.values_=null,void 0!==t&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,i){let s;s=`change:${t}`,this.hasListener(s)&&this.dispatchEvent(new w(s,t,i)),s=e,this.hasListener(s)&&this.dispatchEvent(new w(s,t,i))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const s=this.values_||(this.values_={});if(i)s[t]=e;else{const i=s[t];s[t]=e,i!==e&&this.notify(t,i)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],u(this.values_)&&(this.values_=null),e||this.notify(t,i)}}},M="postrender";const E="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"";E.includes("firefox");E.includes("safari")&&!E.includes("chrom")&&(E.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(E)),E.includes("webkit")&&E.includes("edge"),E.includes("macintosh");const b="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,T="undefined"!=typeof Image&&Image.prototype.decode;function k(t,e,i,s){let n;return n=i&&i.length?i.shift():b?new OffscreenCanvas(t||300,e||300):document.createElement("canvas"),t&&(n.width=t),e&&(n.height=e),n.getContext("2d",s)}function L(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}!function(){let t=!1;try{const e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(t){}}();var F=class extends I{constructor(t){super();const e=t.element;!e||t.target||e.style.pointerEvents||(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){L(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&L(this.element);for(let t=0,e=this.listenerKeys.length;t<e;++t)x(this.listenerKeys[t]);if(this.listenerKeys.length=0,this.map_=t,t){(this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==h&&this.listenerKeys.push(m(t,M,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_="string"==typeof t?document.getElementById(t):t}},A=0,O=1,D=2,P=3;function G(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}class W{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=G(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new W({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return S()}getImage(t){return S()}getHitDetectionImage(){return S()}getPixelRatio(t){return 1}getImageState(){return S()}getImageSize(){return S()}getOrigin(){return S()}getSize(){return S()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=G(t)}listenImageChange(t){S()}load(){S()}unlistenImageChange(t){S()}}var B=W;const N={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection",69:"`width` or `height` cannot be provided together with `scale`"};class X extends Error{constructor(t){const e=N[t];super(e),this.code=t,this.name="AssertionError",this.message=e}}var Y=X;function z(t,e){if(!t)throw new Y(e)}function j(t,e,i){return Math.min(Math.max(t,e),i)}function V(t,e,i,s,n,r){const o=n-i,a=r-s;if(0!==o||0!==a){const l=((t-i)*o+(e-s)*a)/(o*o+a*a);l>1?(i=n,s=r):l>0&&(i+=o*l,s+=a*l)}return Z(t,e,i,s)}function Z(t,e,i,s){const n=i-t,r=s-e;return n*n+r*r}function q(t,e){const i=t%e;return i*e<0?i+e:i}function U(t,e,i){return t+i*(e-t)}const K=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,H=/^([a-z]*)$|^hsla?\(.*\)$/i;function J(t){return"string"==typeof t?t:et(t)}const $=function(){const t={};let e=0;return function(i){let s;if(t.hasOwnProperty(i))s=t[i];else{if(e>=1024){let i=0;for(const s in t)0==(3&i++)&&(delete t[s],--e)}s=function(t){let e,i,s,n,r;H.exec(t)&&(t=function(t){const e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}return""}(t));if(K.exec(t)){const o=t.length-1;let a;a=o<=4?1:2;const l=4===o||8===o;e=parseInt(t.substr(1+0*a,a),16),i=parseInt(t.substr(1+1*a,a),16),s=parseInt(t.substr(1+2*a,a),16),n=l?parseInt(t.substr(1+3*a,a),16):255,1==a&&(e=(e<<4)+e,i=(i<<4)+i,s=(s<<4)+s,l&&(n=(n<<4)+n)),r=[e,i,s,n/255]}else t.startsWith("rgba(")?(r=t.slice(5,-1).split(",").map(Number),tt(r)):t.startsWith("rgb(")?(r=t.slice(4,-1).split(",").map(Number),r.push(1),tt(r)):z(!1,14);return r}(i),t[i]=s,++e}return s}}();function Q(t){return Array.isArray(t)?t:$(t)}function tt(t){return t[0]=j(t[0]+.5|0,0,255),t[1]=j(t[1]+.5|0,0,255),t[2]=j(t[2]+.5|0,0,255),t[3]=j(t[3],0,1),t}function et(t){let e=t[0];e!=(0|e)&&(e=e+.5|0);let i=t[1];i!=(0|i)&&(i=i+.5|0);let s=t[2];s!=(0|s)&&(s=s+.5|0);return"rgba("+e+","+i+","+s+","+(void 0===t[3]?1:Math.round(100*t[3])/100)+")"}function it(t){return Array.isArray(t)?et(t):t}const st=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),nt=["style","variant","weight","size","lineHeight","family"],rt=function(t){const e=t.match(st);if(!e)return null;const i={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let t=0,s=nt.length;t<s;++t){const s=e[t+1];void 0!==s&&(i[nt[t]]=s)}return i.families=i.family.split(/,\s?/),i},ot="10px sans-serif",at="#000",lt="round",ht=[],ct="round",ut="#000",dt="center",gt="middle",ft=[0,0,0,0],_t=new I;let mt,pt=null;const xt={},yt=function(){const t="32px ",e=["monospace","serif"],i=e.length,s="wmytzilWMYTZIL@#/&?$%10ï";let n,r;function o(n,o,a){let l=!0;for(let h=0;h<i;++h){const i=e[h];if(r=Ct(n+" "+o+" "+t+i,s),a!=i){const e=Ct(n+" "+o+" "+t+a+","+i,s);l=l&&e!=r}}return!!l}function a(){let t=!0;const e=_t.getKeys();for(let i=0,s=e.length;i<s;++i){const s=e[i];_t.get(s)<100&&(o.apply(this,s.split("\n"))?(c(xt),pt=null,mt=void 0,_t.set(s,100)):(_t.set(s,_t.get(s)+1,!0),t=!1))}t&&(clearInterval(n),n=void 0)}return function(t){const e=rt(t);if(!e)return;const i=e.families;for(let t=0,s=i.length;t<s;++t){const s=i[t],r=e.style+"\n"+e.weight+"\n"+s;void 0===_t.get(r)&&(_t.set(r,100,!0),o(e.style,e.weight,s)||(_t.set(r,0,!0),void 0===n&&(n=setInterval(a,32))))}}}(),vt=function(){let t;return function(e){let i=xt[e];if(null==i){if(b){const t=rt(e),s=St(e,"Å½g");i=(isNaN(Number(t.lineHeight))?1.2:Number(t.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else t||(t=document.createElement("div"),t.innerHTML="M",t.style.minHeight="0",t.style.maxHeight="none",t.style.height="auto",t.style.padding="0",t.style.border="none",t.style.position="absolute",t.style.display="block",t.style.left="-99999px"),t.style.font=e,document.body.appendChild(t),i=t.offsetHeight,document.body.removeChild(t);xt[e]=i}return i}}();function St(t,e){return pt||(pt=k(1,1)),t!=mt&&(pt.font=t,mt=pt.font),pt.measureText(e)}function Ct(t,e){return St(t,e).width}function Rt(t,e,i){if(e in i)return i[e];const s=e.split("\n").reduce(((e,i)=>Math.max(e,Ct(t,i))),0);return i[e]=s,s}function wt(t,e,i,s,n,r,o,a,l,h,c){t.save(),1!==i&&(t.globalAlpha*=i),e&&t.setTransform.apply(t,e),s.contextInstructions?(t.translate(l,h),t.scale(c[0],c[1]),function(t,e){const i=t.contextInstructions;for(let t=0,s=i.length;t<s;t+=2)Array.isArray(i[t+1])?e[i[t]].apply(e,i[t+1]):e[i[t]]=i[t+1]}(s,t)):c[0]<0||c[1]<0?(t.translate(l,h),t.scale(c[0],c[1]),t.drawImage(s,n,r,o,a,0,0,o,a)):t.drawImage(s,n,r,o,a,l,h,o*c[0],a*c[1]),t.restore()}class It extends B{constructor(t){super({opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=void 0!==t.radius?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new It({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const i=this.renderOptions_,s=k(i.size*t,i.size*t);this.draw_(i,s,t),e=s.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return D}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;let s=this.radius_,n=void 0===this.radius2_?s:this.radius2_;if(s<n){const t=s;s=n,n=t}const r=void 0===this.radius2_?this.points_:2*this.points_,o=2*Math.PI/r,a=n*Math.sin(o),l=s-Math.sqrt(n*n-a*a),h=Math.sqrt(a*a+l*l),c=h/a;if("miter"===t&&c<=i)return c*e;const u=e/2/c,d=e/2*(l/h),g=Math.sqrt((s+u)*(s+u)+d*d)-s;if(void 0===this.radius2_||"bevel"===t)return 2*g;const f=s*Math.sin(o),_=n-Math.sqrt(s*s-f*f),m=Math.sqrt(f*f+_*_)/f;if(m<=i){const t=m*e/2-n-s;return 2*Math.max(g,t)}return 2*g}createRenderOptions(){let t,e=ct,i=0,s=null,n=0,r=0;this.stroke_&&(t=this.stroke_.getColor(),null===t&&(t=ut),t=it(t),r=this.stroke_.getWidth(),void 0===r&&(r=1),s=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset(),e=this.stroke_.getLineJoin(),void 0===e&&(e=ct),i=this.stroke_.getMiterLimit(),void 0===i&&(i=10));const o=this.calculateLineJoinSize_(e,r,i),a=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:r,size:Math.ceil(2*a+o),lineDash:s,lineDashOffset:n,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let t=this.fill_.getColor();null===t&&(t=at),e.fillStyle=it(t),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),i=0;if("string"==typeof e&&(e=Q(e)),null===e?i=1:Array.isArray(e)&&(i=4===e.length?e[3]:1),0===i){const e=k(t.size,t.size);this.hitDetectionCanvas_=e.canvas,this.drawHitDetectionCanvas_(t,e)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const s=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);const n=this.angle_-Math.PI/2,r=2*Math.PI/e;for(let o=0;o<e;o++){const e=n+o*r,a=o%2==0?i:s;t.lineTo(a*Math.cos(e),a*Math.sin(e))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=at,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}var Mt=It;class Et extends Mt{constructor(t){super({points:1/0,fill:(t=t||{radius:5}).fill,radius:t.radius,stroke:t.stroke,scale:void 0!==t.scale?t.scale:1,rotation:void 0!==t.rotation?t.rotation:0,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Et({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}var bt=Et;class Tt{constructor(t){t=t||{},this.color_=void 0!==t.color?t.color:null}clone(){const t=this.getColor();return new Tt({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}var kt=Tt;class Lt{constructor(t){t=t||{},this.color_=void 0!==t.color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Lt({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}var Ft=Lt;class At{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Pt,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.hitDetectionRenderer_=void 0!==t.hitDetectionRenderer?t.hitDetectionRenderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new At({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Pt,this.geometry_=t}setZIndex(t){this.zIndex_=t}}let Ot=null;function Dt(t,e){if(!Ot){const t=new kt({color:"rgba(255,255,255,0.4)"}),e=new Ft({color:"#3399CC",width:1.25});Ot=[new At({image:new bt({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]}return Ot}function Pt(t){return t.getGeometry()}var Gt=At;function Wt(t,e,i){return e+":"+t+":"+(i?J(i):"null")}const Bt=new class{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];0!=(3&t++)||i.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,i){const s=Wt(t,e,i);return s in this.cache_?this.cache_[s]:null}set(t,e,i,s){const n=Wt(t,e,i);this.cache_[n]=s,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};var Nt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Xt(t,e,i){return i?(i[0]=t[0]-e,i[1]=t[1]-e,i[2]=t[2]+e,i[3]=t[3]+e,i):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function Yt(t,e,i){let s,n;return s=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0,n=i<t[1]?t[1]-i:t[3]<i?i-t[3]:0,s*s+n*n}function zt(t,e){return Vt(t,e[0],e[1])}function jt(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function Vt(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]}function Zt(t,e){const i=t[0],s=t[1],n=t[2],r=t[3],o=e[0],a=e[1];let l=Nt.UNKNOWN;return o<i?l|=Nt.LEFT:o>n&&(l|=Nt.RIGHT),a<s?l|=Nt.BELOW:a>r&&(l|=Nt.ABOVE),l===Nt.UNKNOWN&&(l=Nt.INTERSECTING),l}function qt(t,e,i,s,n){return n?(n[0]=t,n[1]=e,n[2]=i,n[3]=s,n):[t,e,i,s]}function Ut(t){return qt(1/0,1/0,-1/0,-1/0,t)}function Kt(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function Ht(t,e,i,s,n){for(;i<s;i+=n)Jt(t,e[i],e[i+1]);return t}function Jt(t,e,i){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],i),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],i)}function $t(t){return[t[0],t[1]]}function Qt(t){return[t[2],t[1]]}function te(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function ee(t,e,i,s,n){const[r,o,a,l,h,c,u,d]=function(t,e,i,s){const n=e*s[0]/2,r=e*s[1]/2,o=Math.cos(i),a=Math.sin(i),l=n*o,h=n*a,c=r*o,u=r*a,d=t[0],g=t[1];return[d-l+u,g-h-c,d-l-u,g-h+c,d+l-u,g+h+c,d+l+u,g+h-c,d-l+u,g-h-c]}(t,e,i,s);return qt(Math.min(r,a,h,u),Math.min(o,l,c,d),Math.max(r,a,h,u),Math.max(o,l,c,d),n)}function ie(t){return t[3]-t[1]}function se(t){return[t[0],t[3]]}function ne(t){return[t[2],t[3]]}function re(t){return t[2]-t[0]}function oe(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function ae(t){return t[2]<t[0]||t[3]<t[1]}function le(t,e,i,s){if(ae(t))return Ut(i);let n=[];if(s>1){const e=t[2]-t[0],i=t[3]-t[1];for(let r=0;r<s;++r)n.push(t[0]+e*r/s,t[1],t[2],t[1]+i*r/s,t[2]-e*r/s,t[3],t[0],t[3]-i*r/s)}else n=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(n,n,2);const r=[],o=[];for(let t=0,e=n.length;t<e;t+=2)r.push(n[t]),o.push(n[t+1]);return function(t,e,i){return qt(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),i)}(r,o,i)}function he(t,e){const i=e.getExtent(),s=te(t);if(e.canWrapX()&&(s[0]<i[0]||s[0]>=i[2])){const e=re(i),n=Math.floor((s[0]-i[0])/e)*e;t[0]-=n,t[2]-=n}return t}let ce=null;class ue extends d{constructor(t,e,i,s,n,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=s,this.canvas_={},this.color_=r,this.unlisten_=null,this.imageState_=n,this.size_=i,this.src_=e,this.tainted_}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&this.imageState_===D){ce||(ce=k(1,1,void 0,{willReadFrequently:!0})),ce.drawImage(this.image_,0,0);try{ce.getImageData(0,0,1,1),this.tainted_=!1}catch(t){ce=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(g)}handleImageError_(){this.imageState_=P,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=D,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=k(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===A){this.image_||this.initializeImage_(),this.imageState_=O;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=function(t,e,i){const s=t;let n=!0,r=!1,o=!1;const a=[p(s,_,(function(){o=!0,r||e()}))];return s.src&&T?(r=!0,s.decode().then((function(){n&&e()})).catch((function(t){n&&(o?e():i())}))):a.push(p(s,f,i)),function(){n=!1,a.forEach(x)}}(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==D)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const s=i.getContext("2d");s.scale(t,t),s.drawImage(e,0,0),s.globalCompositeOperation="multiply",s.fillStyle=J(this.color_),s.fillRect(0,0,i.width/t,i.height/t),s.globalCompositeOperation="destination-in",s.drawImage(e,0,0),this.canvas_[t]=i}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function de(t,e,i,s){return void 0!==i&&void 0!==s?[i/t,s/e]:void 0!==i?i/t:void 0!==s?s/e:1}class ge extends B{constructor(t){const e=void 0!==(t=t||{}).opacity?t.opacity:1,i=void 0!==t.rotation?t.rotation:0,s=void 0!==t.scale?t.scale:1,n=void 0!==t.rotateWithView&&t.rotateWithView;super({opacity:e,rotation:i,scale:s,displacement:void 0!==t.displacement?t.displacement:[0,0],rotateWithView:n,declutterMode:t.declutterMode}),this.anchor_=void 0!==t.anchor?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==t.anchorOrigin?t.anchorOrigin:"top-left",this.anchorXUnits_=void 0!==t.anchorXUnits?t.anchorXUnits:"fraction",this.anchorYUnits_=void 0!==t.anchorYUnits?t.anchorYUnits:"fraction",this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;const r=void 0!==t.img?t.img:null;this.imgSize_=t.imgSize;let o=t.src;z(!(void 0!==o&&r),4),z(!r||r&&this.imgSize_,5),void 0!==o&&0!==o.length||!r||(o=r.src||R(r)),z(void 0!==o&&o.length>0,6),z(!((void 0!==t.width||void 0!==t.height)&&void 0!==t.scale),69);const a=void 0!==t.src?A:D;if(this.color_=void 0!==t.color?Q(t.color):null,this.iconImage_=function(t,e,i,s,n,r){let o=Bt.get(e,s,r);return o||(o=new ue(t,e,i,s,n,r),Bt.set(e,s,r,o)),o}(r,o,void 0!==this.imgSize_?this.imgSize_:null,this.crossOrigin_,a,this.color_),this.offset_=void 0!==t.offset?t.offset:[0,0],this.offsetOrigin_=void 0!==t.offsetOrigin?t.offsetOrigin:"top-left",this.origin_=null,this.size_=void 0!==t.size?t.size:null,void 0!==t.width||void 0!==t.height){let e,i;if(t.size)[e,i]=t.size;else{const s=this.getImage(1);if(!(s instanceof HTMLCanvasElement||s.src&&s.complete)){this.initialOptions_=t;const e=()=>{if(this.unlistenImageChange(e),!this.initialOptions_)return;const i=this.iconImage_.getSize();this.setScale(de(i[0],i[1],t.width,t.height))};return void this.listenImageChange(e)}e=s.width,i=s.height}void 0!==e&&this.setScale(de(e,i,t.width,t.height))}}clone(){let t,e,i;this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t);return new ge({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const e=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!e)return null;t=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(t[0]*=e[0]),"fraction"==this.anchorYUnits_&&(t[1]*=e[1])}if("top-left"!=this.anchorOrigin_){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),"top-right"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(t[0]=-t[0]+e[0]),"bottom-left"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if("top-left"!=this.offsetOrigin_){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),"top-right"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(t[0]=i[0]-e[0]-t[0]),"bottom-left"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();return this.size_?this.size_[0]*t[0]:this.iconImage_.getImageState()==D?this.iconImage_.getSize()[0]*t[0]:void 0}getHeight(){const t=this.getScaleArray();return this.size_?this.size_[1]*t[1]:this.iconImage_.getImageState()==D?this.iconImage_.getSize()[1]*t[1]:void 0}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(g,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(g,t)}}var fe=ge,_e="gcd-container",me="gcd-button-control",pe="gcd-input-query",xe="gcd-input-reset",ye={namespace:"ol-geocoder",spin:"gcd-pseudo-rotate",hidden:"gcd-hidden",address:"gcd-address",country:"gcd-country",city:"gcd-city",road:"gcd-road",olControl:"ol-control",glass:{container:"gcd-gl-container",control:"gcd-gl-control",button:"gcd-gl-btn",input:"gcd-gl-input",expanded:"gcd-gl-expanded",reset:"gcd-gl-reset",result:"gcd-gl-result"},inputText:{container:"gcd-txt-container",control:"gcd-txt-control",input:"gcd-txt-input",reset:"gcd-txt-reset",icon:"gcd-txt-glass",result:"gcd-txt-result"}},ve={containerId:_e,buttonControlId:me,inputQueryId:pe,inputResetId:xe,cssClasses:ye};const Se=Object.freeze({__proto__:null,buttonControlId:me,containerId:_e,cssClasses:ye,default:ve,inputQueryId:pe,inputResetId:xe}),Ce="addresschosen",Re="nominatim",we="reverse",Ie="glass-button",Me="text-input",Ee="osm",be="mapquest",Te="photon",ke="bing",Le="opencage",Fe={provider:Ee,placeholder:"Search for an address",featureStyle:null,targetType:Ie,lang:"en-US",limit:5,keepOpen:!1,preventDefault:!1,autoComplete:!1,autoCompleteMinLength:2,autoCompleteTimeout:200,debug:!1};function Ae(t,e="Assertion failed"){if(!t){if("undefined"!=typeof Error)throw new Error(e);throw e}}function Oe(t){const e=function(){if(
// @license http://opensource.org/licenses/MIT
"performance"in window==0&&(window.performance={}),"now"in window.performance==0){let t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=()=>Date.now()-t}return window.performance.now()}().toString(36);return t?t+e:e}function De(t){return/^\d+$/u.test(t)}function Pe(t,e,i){if(Array.isArray(t))return void t.forEach((t=>Pe(t,e)));const s=Array.isArray(e)?e:e.split(/\s+/u);let n=s.length;for(;n--;)We(t,s[n])||Ye(t,s[n],i)}function Ge(t,e,i){if(Array.isArray(t))return void t.forEach((t=>Ge(t,e,i)));const s=Array.isArray(e)?e:e.split(/\s+/u);let n=s.length;for(;n--;)We(t,s[n])&&ze(t,s[n],i)}function We(t,e){return t.classList?t.classList.contains(e):Xe(e).test(t.className)}function Be(t,e){return t.replace(/\{\s*([\w-]+)\s*\}/gu,((t,i)=>{const s=void 0===e[i]?"":e[i];return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}))}function Ne(t,e){let i;if(Array.isArray(t)){if(i=document.createElement(t[0]),t[1].id&&(i.id=t[1].id),t[1].classname&&(i.className=t[1].classname),t[1].attr){const{attr:e}=t[1];if(Array.isArray(e)){let t=-1;for(;++t<e.length;)i.setAttribute(e[t].name,e[t].value)}else i.setAttribute(e.name,e.value)}}else i=document.createElement(t);i.innerHTML=e;const s=document.createDocumentFragment();for(;i.childNodes[0];)s.append(i.childNodes[0]);return i.append(s),i}function Xe(t){return new RegExp(`(^|\\s+) ${t} (\\s+|$)`,"u")}function Ye(t,e,i){t.classList?t.classList.add(e):t.className=`${t.className} ${e}`.trim(),i&&De(i)&&window.setTimeout((()=>ze(t,e)),i)}function ze(t,e,i){t.classList?t.classList.remove(e):t.className=t.className.replace(Xe(e)," ").trim(),i&&De(i)&&window.setTimeout((()=>Ye(t,e)),i)}const je=Se.cssClasses;class Ve{constructor(t){this.options=t.options,this.els=this.createControl()}createControl(){let t,e,i;return this.options.targetType===Me?(e=`${je.namespace} ${je.inputText.container}`,t=Ne(["div",{id:Se.containerId,classname:e}],Ve.input),i={container:t,control:t.querySelector(`.${je.inputText.control}`),input:t.querySelector(`.${je.inputText.input}`),reset:t.querySelector(`.${je.inputText.reset}`),result:t.querySelector(`.${je.inputText.result}`)}):(e=`${je.namespace} ${je.glass.container}`,t=Ne(["div",{id:Se.containerId,classname:e}],Ve.glass),i={container:t,control:t.querySelector(`.${je.glass.control}`),button:t.querySelector(`.${je.glass.button}`),input:t.querySelector(`.${je.glass.input}`),reset:t.querySelector(`.${je.glass.reset}`),result:t.querySelector(`.${je.glass.result}`)}),i.input.placeholder=this.options.placeholder,i}}Ve.glass=`\n  <div class="${je.glass.control} ${je.olControl}">\n    <button type="button" id="${Se.buttonControlId}" class="${je.glass.button}"></button>\n    <input type="text" id="${Se.inputQueryId}" class="${je.glass.input}" autocomplete="off" placeholder="Search ...">\n    <a id="${Se.inputResetId}" class="${je.glass.reset} ${je.hidden}"></a>\n  </div>\n  <ul class="${je.glass.result}"></ul>\n`,Ve.input=`\n  <div class="${je.inputText.control}">\n    <input type="text" id="${Se.inputQueryId}" class="${je.inputText.input}" autocomplete="off" placeholder="Search ...">\n    <span class="${je.inputText.icon}"></span>\n    <button type="button" id="${Se.inputResetId}" class="${je.inputText.reset} ${je.hidden}"></button>\n  </div>\n  <ul class="${je.inputText.result}"></ul>\n`;var Ze="opacity",qe="visible",Ue="extent",Ke="zIndex",He="maxResolution",Je="minResolution",$e="maxZoom",Qe="minZoom",ti="source",ei="map";var ii=class extends I{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);"object"==typeof t.properties&&(delete e.properties,Object.assign(e,t.properties)),e[Ze]=void 0!==t.opacity?t.opacity:1,z("number"==typeof e[Ze],64),e[qe]=void 0===t.visible||t.visible,e[Ke]=t.zIndex,e[He]=void 0!==t.maxResolution?t.maxResolution:1/0,e[Je]=void 0!==t.minResolution?t.minResolution:0,e[Qe]=void 0!==t.minZoom?t.minZoom:-1/0,e[$e]=void 0!==t.maxZoom?t.maxZoom:1/0,this.className_=void 0!==e.className?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:void 0===t||t},i=this.getZIndex();return e.opacity=j(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==i||e.managed?i:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return S()}getLayerStatesArray(t){return S()}getExtent(){return this.get(Ue)}getMaxResolution(){return this.get(He)}getMinResolution(){return this.get(Je)}getMinZoom(){return this.get(Qe)}getMaxZoom(){return this.get($e)}getOpacity(){return this.get(Ze)}getSourceState(){return S()}getVisible(){return this.get(qe)}getZIndex(){return this.get(Ke)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Ue,t)}setMaxResolution(t){this.set(He,t)}setMinResolution(t){this.set(Je,t)}setMaxZoom(t){this.set($e,t)}setMinZoom(t){this.set(Qe,t)}setOpacity(t){z("number"==typeof t,64),this.set(Ze,t)}setVisible(t){this.set(qe,t)}setZIndex(t){this.set(Ke,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},si="prerender",ni="postrender",ri="precompose",oi=0,ai=1,li={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};const hi={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var ci=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||hi[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const ui=6378137,di=Math.PI*ui,gi=[-di,-di,di,di],fi=[-180,-85,180,85],_i=ui*Math.log(Math.tan(Math.PI/2));class mi extends ci{constructor(t){super({code:t,units:"m",extent:gi,global:!0,worldExtent:fi,getPointResolution:function(t,e){return t/Math.cosh(e[1]/ui)}})}}const pi=[new mi("EPSG:3857"),new mi("EPSG:102100"),new mi("EPSG:102113"),new mi("EPSG:900913"),new mi("http://www.opengis.net/def/crs/EPSG/0/3857"),new mi("http://www.opengis.net/gml/srs/epsg.xml#3857")];function xi(t,e,i){const s=t.length;i=i>1?i:2,void 0===e&&(e=i>2?t.slice():new Array(s));for(let n=0;n<s;n+=i){e[n]=di*t[n]/180;let i=ui*Math.log(Math.tan(Math.PI*(+t[n+1]+90)/360));i>_i?i=_i:i<-_i&&(i=-_i),e[n+1]=i}return e}function yi(t,e,i){const s=t.length;i=i>1?i:2,void 0===e&&(e=i>2?t.slice():new Array(s));for(let n=0;n<s;n+=i)e[n]=180*t[n]/di,e[n+1]=360*Math.atan(Math.exp(t[n+1]/ui))/Math.PI-90;return e}const vi=[-180,-90,180,90],Si=6378137*Math.PI/180;class Ci extends ci{constructor(t,e){super({code:t,units:"degrees",extent:vi,axisOrientation:e,global:!0,metersPerUnit:Si,worldExtent:vi})}}const Ri=[new Ci("CRS:84"),new Ci("EPSG:4326","neu"),new Ci("urn:ogc:def:crs:OGC:1.3:CRS84"),new Ci("urn:ogc:def:crs:OGC:2:84"),new Ci("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Ci("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Ci("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let wi={};let Ii={};function Mi(t,e,i){const s=t.getCode(),n=e.getCode();s in Ii||(Ii[s]={}),Ii[s][n]=i}function Ei(t,e){let i=!0;for(let s=t.length-1;s>=0;--s)if(t[s]!=e[s]){i=!1;break}return i}function bi(t,e){if(e.canWrapX()){const i=re(e.getExtent()),s=function(t,e,i){const s=e.getExtent();let n=0;e.canWrapX()&&(t[0]<s[0]||t[0]>s[2])&&(i=i||re(s),n=Math.floor((t[0]-s[0])/i));return n}(t,e,i);s&&(t[0]-=s*i)}return t}const Ti={info:1,warn:2,error:3,none:4};let ki=Ti.info;let Li=!0;function Fi(t,e){if(void 0!==e)for(let i=0,s=t.length;i<s;++i)e[i]=t[i];else e=t.slice();return e}function Ai(t,e){if(void 0!==e&&t!==e){for(let i=0,s=t.length;i<s;++i)e[i]=t[i];t=e}return t}function Oi(t){!function(t,e){wi[t]=e}(t.getCode(),t),Mi(t,t,Fi)}function Di(t){return"string"==typeof t?wi[e=t]||wi[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function Pi(t){!function(t){t.forEach(Oi)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&Mi(e,t,Fi)}))}))}function Gi(t,e){return t?"string"==typeof t?Di(t):t:Di(e)}function Wi(t,e){let i=function(t,e){let i;return t in Ii&&e in Ii[t]&&(i=Ii[t][e]),i}(t.getCode(),e.getCode());return i||(i=Ai),i}function Bi(t,e){return Wi(Di(t),Di(e))}function Ni(t,e){return t}function Xi(t,e){return Li&&!Ei(t,[0,0])&&t[0]>=-180&&t[0]<=180&&t[1]>=-90&&t[1]<=90&&(Li=!1,function(...t){ki>Ti.warn||console.warn(...t)}("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),t}function Yi(t,e){return t}function zi(t,e){return t}var ji,Vi,Zi;function qi(t,e,i){return function(s,n,r,o,a){if(!s)return;if(!n&&!e)return s;const l=e?0:r[0]*n,h=e?0:r[1]*n,c=a?a[0]:0,u=a?a[1]:0;let d=t[0]+l/2+c,g=t[2]-l/2+c,f=t[1]+h/2+u,_=t[3]-h/2+u;d>g&&(d=(g+d)/2,g=d),f>_&&(f=(_+f)/2,_=f);let m=j(s[0],d,g),p=j(s[1],f,_);if(o&&i&&n){const t=30*n;m+=-t*Math.log(1+Math.max(0,d-s[0])/t)+t*Math.log(1+Math.max(0,s[0]-g)/t),p+=-t*Math.log(1+Math.max(0,f-s[1])/t)+t*Math.log(1+Math.max(0,s[1]-_)/t)}return[m,p]}}function Ui(t){return t}function Ki(t,e,i,s){const n=re(e)/i[0],r=ie(e)/i[1];return s?Math.min(t,Math.max(n,r)):Math.min(t,Math.min(n,r))}function Hi(t,e,i){let s=Math.min(t,e);return s*=Math.log(1+50*Math.max(0,t/e-1))/50+1,i&&(s=Math.max(s,i),s/=Math.log(1+50*Math.max(0,i/t-1))/50+1),j(s,i/2,2*e)}function Ji(t,e,i,s,n){return i=void 0===i||i,function(r,o,a,l){if(void 0!==r){const o=s?Ki(t,s,a,n):t;return i&&l?Hi(r,o,e):j(r,e,o)}}}function $i(t){if(void 0!==t)return 0}function Qi(t){if(void 0!==t)return t}function ts(t){return t=t||5*Math.PI/180,function(e,i){return i?e:void 0!==e?Math.abs(e)<=t?0:e:void 0}}function es(t){return 1-function(t){return Math.pow(t,3)}(1-t)}function is(t){return 3*t*t-2*t*t*t}function ss(t,e){const i=e[0],s=e[1];return e[0]=t[0]*i+t[2]*s+t[4],e[1]=t[1]*i+t[3]*s+t[5],e}function ns(t,e,i,s,n,r,o,a){const l=Math.sin(r),h=Math.cos(r);return t[0]=s*h,t[1]=n*l,t[2]=-s*l,t[3]=n*h,t[4]=o*s*h-a*s*l+e,t[5]=o*n*l+a*n*h+i,t}let rs;function os(t,e,i,s,n,r){r=r||[];let o=0;for(let a=e;a<i;a+=s){const e=t[a],i=t[a+1];r[o++]=n[0]*e+n[2]*i+n[4],r[o++]=n[1]*e+n[3]*i+n[5]}return r&&r.length!=o&&(r.length=o),r}function as(t,e,i,s,n,r,o){o=o||[];const a=Math.cos(n),l=Math.sin(n),h=r[0],c=r[1];let u=0;for(let n=e;n<i;n+=s){const e=t[n]-h,i=t[n+1]-c;o[u++]=h+e*a-i*l,o[u++]=c+e*l+i*a;for(let e=n+2;e<n+s;++e)o[u++]=t[e]}return o&&o.length!=u&&(o.length=u),o}Pi(pi),Pi(Ri),ji=pi,Vi=xi,Zi=yi,Ri.forEach((function(t){ji.forEach((function(e){Mi(t,e,Vi),Mi(e,t,Zi)}))})),new Array(6);const ls=[1,0,0,1,0,0];var hs=class extends I{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=function(t){let e,i,s,n=!1;return function(){const r=Array.prototype.slice.call(arguments);return n&&this===s&&a(r,i)||(n=!0,s=this,i=r,e=t.apply(this,arguments)),e}}((function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(i),s.getSimplifiedGeometry(e)}))}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return S()}closestPointXY(t,e,i,s){return S()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return S()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Ut(t),this.extentRevision_=this.getRevision()}return function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)}rotate(t,e){S()}scale(t,e,i){S()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return S()}getType(){return S()}applyTransform(t){S()}intersectsExtent(t){return S()}translate(t,e){S()}transform(t,e){const i=Di(t),s="tile-pixels"==i.getUnits()?function(t,s,n){const r=i.getExtent(),o=i.getWorldExtent(),a=ie(o)/ie(r);return ns(ls,o[0],o[3],a,-a,0,0,0),os(t,0,t.length,n,ls,s),Bi(i,e)(t,s,n)}:Bi(i,e);return this.applyTransform(s),this}};function cs(t){let e;return"XY"==t?e=2:"XYZ"==t||"XYM"==t?e=3:"XYZM"==t&&(e=4),e}var us=class extends hs{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return e=this.flatCoordinates,i=0,s=this.flatCoordinates.length,n=this.stride,Ht(Ut(t),e,i,s,n);var e,i,s,n}getCoordinates(){return S()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=cs(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){S()}setLayout(t,e,i){let s;if(t)s=cs(t);else{for(let t=0;t<i;++t){if(0===e.length)return this.layout="XY",void(this.stride=2);e=e[0]}s=e.length,t=function(t){let e;2==t?e="XY":3==t?e="XYZ":4==t&&(e="XYZM");return e}(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const s=this.getStride();as(i,0,i.length,s,t,e,i),this.changed()}}scale(t,e,i){void 0===e&&(e=t),i||(i=te(this.getExtent()));const s=this.getFlatCoordinates();if(s){const n=this.getStride();!function(t,e,i,s,n,r,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let o=e;o<i;o+=s){const e=t[o]-l,i=t[o+1]-h;a[c++]=l+n*e,a[c++]=h+r*i;for(let e=o+2;e<o+s;++e)a[c++]=t[e]}a&&a.length!=c&&(a.length=c)}(s,0,s.length,n,t,e,i,s),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const s=this.getStride();!function(t,e,i,s,n,r,o){o=o||[];let a=0;for(let l=e;l<i;l+=s){o[a++]=t[l]+n,o[a++]=t[l+1]+r;for(let e=l+2;e<l+s;++e)o[a++]=t[e]}o&&o.length!=a&&(o.length=a)}(i,0,i.length,s,t,e,i),this.changed()}}};function ds(t,e,i,s,n,r,o){const a=t[e],l=t[e+1],h=t[i]-a,c=t[i+1]-l;let u;if(0===h&&0===c)u=e;else{const d=((n-a)*h+(r-l)*c)/(h*h+c*c);if(d>1)u=i;else{if(d>0){for(let n=0;n<s;++n)o[n]=U(t[e+n],t[i+n],d);return void(o.length=s)}u=e}}for(let e=0;e<s;++e)o[e]=t[u+e];o.length=s}function gs(t,e,i,s,n){let r=t[e],o=t[e+1];for(e+=s;e<i;e+=s){const i=t[e],s=t[e+1],a=Z(r,o,i,s);a>n&&(n=a),r=i,o=s}return n}function fs(t,e,i,s,n,r,o,a,l,h,c){if(e==i)return h;let u,d;if(0===n){if(d=Z(o,a,t[e],t[e+1]),d<h){for(u=0;u<s;++u)l[u]=t[e+u];return l.length=s,d}return h}c=c||[NaN,NaN];let g=e+s;for(;g<i;)if(ds(t,g-s,g,s,o,a,c),d=Z(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<s;++u)l[u]=c[u];l.length=s,g+=s}else g+=s*Math.max((Math.sqrt(d)-Math.sqrt(h))/n|0,1);if(r&&(ds(t,i-s,e,s,o,a,c),d=Z(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<s;++u)l[u]=c[u];l.length=s}return h}function _s(t,e,i,s){for(let n=0,r=i.length;n<r;++n){const r=i[n];for(let i=0;i<s;++i)t[e++]=r[i]}return e}function ms(t,e){return e*Math.round(t/e)}function ps(t,e,i,s,n,r,o){if(e==i)return o;let a,l,h=ms(t[e],n),c=ms(t[e+1],n);e+=s,r[o++]=h,r[o++]=c;do{if(a=ms(t[e],n),l=ms(t[e+1],n),(e+=s)==i)return r[o++]=a,r[o++]=l,o}while(a==h&&l==c);for(;e<i;){const i=ms(t[e],n),u=ms(t[e+1],n);if(e+=s,i==a&&u==l)continue;const d=a-h,g=l-c,f=i-h,_=u-c;d*_==g*f&&(d<0&&f<d||d==f||d>0&&f>d)&&(g<0&&_<g||g==_||g>0&&_>g)?(a=i,l=u):(r[o++]=a,r[o++]=l,h=a,c=l,a=i,l=u)}return r[o++]=a,r[o++]=l,o}function xs(t,e,i,s,n){n=void 0!==n?n:[];let r=0;for(let o=e;o<i;o+=s)n[r++]=t.slice(o,o+s);return n.length=r,n}function ys(t,e,i,s,n){n=void 0!==n?n:[];let r=0;for(let o=0,a=i.length;o<a;++o){const a=i[o];n[r++]=xs(t,e,a,s,n[r]),e=a}return n.length=r,n}function vs(t,e,i,s,n){n=void 0!==n?n:[];let r=0;for(let o=0,a=i.length;o<a;++o){const a=i[o];n[r++]=1===a.length&&a[0]===e?[]:ys(t,e,a,s,n[r]),e=a[a.length-1]}return n.length=r,n}function Ss(t,e,i,s){let n=0,r=t[i-s],o=t[i-s+1];for(;e<i;e+=s){const i=t[e],s=t[e+1];n+=o*i-r*s,r=i,o=s}return n/2}class Cs extends us{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}clone(){return new Cs(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,s){return s<Yt(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),fs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,s))}getArea(){return Ss(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return xs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=function(t,e,i,s,n,r,o){const a=(i-e)/s;if(a<3){for(;e<i;e+=s)r[o++]=t[e],r[o++]=t[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,i-s];let c=0;for(;h.length>0;){const i=h.pop(),r=h.pop();let o=0;const a=t[r],u=t[r+1],d=t[i],g=t[i+1];for(let e=r+s;e<i;e+=s){const i=V(t[e],t[e+1],a,u,d,g);i>o&&(c=e,o=i)}o>n&&(l[(c-e)/s]=1,r+s<c&&h.push(r,c),c+s<i&&h.push(c,i))}for(let i=0;i<a;++i)l[i]&&(r[o++]=t[e+i*s],r[o++]=t[e+i*s+1]);return o}(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Cs(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=_s(this.flatCoordinates,0,t,this.stride),this.changed()}}var Rs=Cs;class ws extends us{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new ws(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){const n=this.flatCoordinates,r=Z(t,e,n[0],n[1]);if(r<s){const t=this.stride;for(let e=0;e<t;++e)i[e]=n[e];return i.length=t,r}return s}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return function(t,e){const i=t[0],s=t[1];return qt(i,s,i,s,e)}(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Vt(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function(t,e,i,s){for(let s=0,n=i.length;s<n;++s)t[e++]=i[s];return e}(this.flatCoordinates,0,t,this.stride),this.changed()}}var Is=ws;function Ms(t,e,i,s,n){const r=function(t,e){let i;return i=e($t(t)),i||(i=e(Qt(t)),i||(i=e(ne(t)),i||(i=e(se(t)),i||!1)))}(n,(function(n){return!Es(t,e,i,s,n[0],n[1])}));return!r}function Es(t,e,i,s,n,r){let o=0,a=t[i-s],l=t[i-s+1];for(;e<i;e+=s){const i=t[e],s=t[e+1];l<=r?s>r&&(i-a)*(r-l)-(n-a)*(s-l)>0&&o++:s<=r&&(i-a)*(r-l)-(n-a)*(s-l)<0&&o--,a=i,l=s}return 0!==o}function bs(t,e,i,s,n,r){if(0===i.length)return!1;if(!Es(t,e,i[0],s,n,r))return!1;for(let e=1,o=i.length;e<o;++e)if(Es(t,i[e-1],i[e],s,n,r))return!1;return!0}function Ts(t,e,i,s,n){const r=Ht([1/0,1/0,-1/0,-1/0],t,e,i,s);return!!oe(n,r)&&(!!jt(n,r)||(r[0]>=n[0]&&r[2]<=n[2]||(r[1]>=n[1]&&r[3]<=n[3]||function(t,e,i,s,n){let r;for(e+=s;e<i;e+=s)if(r=n(t.slice(e-s,e),t.slice(e,e+s)),r)return r;return!1}(t,e,i,s,(function(t,e){return function(t,e,i){let s=!1;const n=Zt(t,e),r=Zt(t,i);if(n===Nt.INTERSECTING||r===Nt.INTERSECTING)s=!0;else{const o=t[0],a=t[1],l=t[2],h=t[3],c=e[0],u=e[1],d=i[0],g=i[1],f=(g-u)/(d-c);let _,m;r&Nt.ABOVE&&!(n&Nt.ABOVE)&&(_=d-(g-h)/f,s=_>=o&&_<=l),s||!(r&Nt.RIGHT)||n&Nt.RIGHT||(m=g-(d-l)*f,s=m>=a&&m<=h),s||!(r&Nt.BELOW)||n&Nt.BELOW||(_=d-(g-a)/f,s=_>=o&&_<=l),s||!(r&Nt.LEFT)||n&Nt.LEFT||(m=g-(d-o)*f,s=m>=a&&m<=h)}return s}(n,t,e)})))))}function ks(t,e,i,s,n){if(!function(t,e,i,s,n){return!!(Ts(t,e,i,s,n)||Es(t,e,i,s,n[0],n[1])||Es(t,e,i,s,n[0],n[3])||Es(t,e,i,s,n[2],n[1])||Es(t,e,i,s,n[2],n[3]))}(t,e,i[0],s,n))return!1;if(1===i.length)return!0;for(let e=1,r=i.length;e<r;++e)if(Ms(t,i[e-1],i[e],s,n)&&!Ts(t,i[e-1],i[e],s,n))return!1;return!0}function Ls(t,e,i,s){for(;e<i-s;){for(let n=0;n<s;++n){const r=t[e+n];t[e+n]=t[i-s+n],t[i-s+n]=r}e+=s,i-=s}}function Fs(t,e,i,s){let n=0,r=t[i-s],o=t[i-s+1];for(;e<i;e+=s){const i=t[e],s=t[e+1];n+=(i-r)*(s+o),r=i,o=s}return 0===n?void 0:n>0}function As(t,e,i,s,n){n=void 0!==n&&n;for(let r=0,o=i.length;r<o;++r){const o=i[r],a=Fs(t,e,o,s);(0===r?n&&a||!n&&!a:n&&!a||!n&&a)&&Ls(t,e,o,s),e=o}return e}class Os extends us{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==e&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?o(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Os(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<Yt(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,i,s,n){for(let r=0,o=i.length;r<o;++r){const o=i[r];n=gs(t,e,o,s,n),e=o}return n}(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,i,s,n,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=i.length;u<d;++u){const d=i[u];h=fs(t,e,d,s,n,r,o,a,l,h,c),e=d}return h}(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return bs(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return function(t,e,i,s){let n=0;for(let r=0,o=i.length;r<o;++r){const o=i[r];n+=Ss(t,e,o,s),e=o}return n}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),As(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,ys(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=te(this.getExtent());this.flatInteriorPoint_=function(t,e,i,n,r,o,a){let l,h,c,u,d,g,f;const _=r[o+1],m=[];for(let s=0,r=i.length;s<r;++s){const r=i[s];for(u=t[r-n],g=t[r-n+1],l=e;l<r;l+=n)d=t[l],f=t[l+1],(_<=g&&f<=_||g<=_&&_<=f)&&(c=(_-g)/(f-g)*(d-u)+u,m.push(c)),u=d,g=f}let p=NaN,x=-1/0;for(m.sort(s),u=m[0],l=1,h=m.length;l<h;++l){d=m[l];const s=Math.abs(d-u);s>x&&(c=(u+d)/2,bs(t,e,i,n,c,_)&&(p=c,x=s)),u=d}return isNaN(p)&&(p=r[o]),a?(a.push(p,_,x),a):[p,_,x]}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Is(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Rs(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,s=[];let n=0;for(let r=0,o=i.length;r<o;++r){const o=i[r],a=new Rs(e.slice(n,o),t);s.push(a),n=o}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;!function(t,e,i,s,n){n=void 0!==n&&n;for(let r=0,o=i.length;r<o;++r){const o=i[r],a=Fs(t,e,o,s);if(0===r){if(n&&a||!n&&!a)return!1}else if(n&&!a||!n&&a)return!1;e=o}return!0}(t,0,this.ends_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=As(this.orientedFlatCoordinates_,0,this.ends_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=function(t,e,i,s,n,r,o,a){for(let l=0,h=i.length;l<h;++l){const h=i[l];o=ps(t,e,h,s,n,r,o),a.push(o),e=h}return o}(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new Os(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return ks(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=function(t,e,i,s,n){n=n||[];let r=0;for(let o=0,a=i.length;o<a;++o){const a=_s(t,e,i[o],s);n[r++]=a,e=a}return n.length=r,n}(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}function Ds(t){if(ae(t))throw new Error("Cannot create polygon from empty extent");const e=t[0],i=t[1],s=t[2],n=t[3],r=[e,i,e,n,s,n,s,i,e,i];return new Os(r,"XY",[r.length])}function Ps(t,e){setTimeout((function(){t(e)}),0)}function Gs(t){return!(t.sourceCenter&&t.targetCenter&&!Ei(t.sourceCenter,t.targetCenter))&&(t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation)}function Ws(t,e,i,s,n){const r=Math.cos(-n);let o=Math.sin(-n),a=t[0]*r-t[1]*o,l=t[1]*r+t[0]*o;a+=(e[0]/2-i[0])*s,l+=(i[1]-e[1]/2)*s,o=-o;return[a*r-l*o,l*r+a*o]}var Bs=class extends I{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Gi(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&function(t){Li=!(void 0===t||t)}(),t.center&&(t.center=Xi(t.center,this.projection_)),t.extent&&(t.extent=zi(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const t in li)delete e[t];this.setProperties(e,!0);const i=function(t){let e,i,s;const r=28,o=2;let a=void 0!==t.minZoom?t.minZoom:0,l=void 0!==t.maxZoom?t.maxZoom:r;const h=void 0!==t.zoomFactor?t.zoomFactor:o,c=void 0!==t.multiWorld&&t.multiWorld,u=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,d=void 0!==t.showFullExtent&&t.showFullExtent,g=Gi(t.projection,"EPSG:3857"),f=g.getExtent();let _=t.constrainOnlyCenter,m=t.extent;c||m||!g.isGlobal()||(_=!1,m=f);if(void 0!==t.resolutions){const r=t.resolutions;i=r[a],s=void 0!==r[l]?r[l]:r[r.length-1],e=t.constrainResolution?function(t,e,i,s){return e=void 0===e||e,function(r,o,a,l){if(void 0!==r){const h=t[0],c=t[t.length-1],u=i?Ki(h,i,a,s):h;if(l)return e?Hi(r,u,c):j(r,c,u);const d=Math.min(u,r),g=Math.floor(n(t,d,o));return t[g]>u&&g<t.length-1?t[g+1]:t[g]}}}(r,u,!_&&m,d):Ji(i,s,u,!_&&m,d)}else{const n=(f?Math.max(re(f),ie(f)):360*hi.degrees/g.getMetersPerUnit())/256/Math.pow(o,0),c=n/Math.pow(o,r-0);i=t.maxResolution,void 0!==i?a=0:i=n/Math.pow(h,a),s=t.minResolution,void 0===s&&(s=void 0!==t.maxZoom?void 0!==t.maxResolution?i/Math.pow(h,l):n/Math.pow(h,l):c),l=a+Math.floor(Math.log(i/s)/Math.log(h)),s=i/Math.pow(h,l-a),e=t.constrainResolution?function(t,e,i,s,n,r){return s=void 0===s||s,i=void 0!==i?i:0,function(o,a,l,h){if(void 0!==o){const c=n?Ki(e,n,l,r):e;if(h)return s?Hi(o,c,i):j(o,i,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(t)-u),g=-a*(.5-u)+.5,f=Math.min(c,o),_=Math.floor(Math.log(e/f)/Math.log(t)+g),m=Math.max(d,_);return j(e/Math.pow(t,m),i,c)}}}(h,i,s,u,!_&&m,d):Ji(i,s,u,!_&&m,d)}return{constraint:e,maxResolution:i,minResolution:s,minZoom:a,zoomFactor:h}}(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const s=function(t){if(void 0!==t.extent){const e=void 0===t.smoothExtentConstraint||t.smoothExtentConstraint;return qi(t.extent,t.constrainOnlyCenter,e)}const e=Gi(t.projection,"EPSG:3857");if(!0!==t.multiWorld&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,qi(t,!1,!1)}return Ui}(t),r=i.constraint,o=function(t){const e=void 0===t.enableRotation||t.enableRotation;if(e){const e=t.constrainRotation;return void 0===e||!0===e?ts():!1===e?Qi:"number"==typeof e?function(t){const e=2*Math.PI/t;return function(t,i){return i?t:void 0!==t?t=Math.floor(t/e+.5)*e:void 0}}(e):Qi}return $i}(t);this.constraints_={center:s,resolution:r,rotation:o},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenterInternal();if(i){const s=t||[0,0,0,0];e=e||[0,0,0,0];const n=this.getResolution(),r=n/2*(s[3]-e[3]+e[1]-s[1]),o=n/2*(s[0]-e[0]+e[2]-s[2]);this.setCenterInternal([i[0]+r,i[1]-o])}}getUpdatedOptions_(t){const e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let t=0;t<e.length;++t){let i=arguments[t];i.center&&(i=Object.assign({},i),i.center=Xi(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=Xi(i.anchor,this.getProjection())),e[t]=i}this.animateInternal.apply(this,e)}animateInternal(t){let e,i=arguments.length;i>1&&"function"==typeof arguments[i-1]&&(e=arguments[i-1],--i);let s=0;for(;s<i&&!this.isDef();++s){const t=arguments[s];t.center&&this.setCenterInternal(t.center),void 0!==t.zoom?this.setZoom(t.zoom):t.resolution&&this.setResolution(t.resolution),void 0!==t.rotation&&this.setRotation(t.rotation)}if(s===i)return void(e&&Ps(e,!0));let n=Date.now(),r=this.targetCenter_.slice(),o=this.targetResolution_,a=this.targetRotation_;const l=[];for(;s<i;++s){const t=arguments[s],i={start:n,complete:!1,anchor:t.anchor,duration:void 0!==t.duration?t.duration:1e3,easing:t.easing||is,callback:e};if(t.center&&(i.sourceCenter=r,i.targetCenter=t.center.slice(),r=i.targetCenter),void 0!==t.zoom?(i.sourceResolution=o,i.targetResolution=this.getResolutionForZoom(t.zoom),o=i.targetResolution):t.resolution&&(i.sourceResolution=o,i.targetResolution=t.resolution,o=i.targetResolution),void 0!==t.rotation){i.sourceRotation=a;const e=q(t.rotation-a+Math.PI,2*Math.PI)-Math.PI;i.targetRotation=a+e,a=i.targetRotation}Gs(i)?i.complete=!0:n+=i.duration,l.push(i)}this.animations_.push(l),this.setHint(oi,1),this.updateAnimations_()}getAnimating(){return this.hints_[oi]>0}getInteracting(){return this.hints_[ai]>0}cancelAnimations(){let t;this.setHint(oi,-this.hints_[oi]);for(let e=0,i=this.animations_.length;e<i;++e){const i=this.animations_[e];if(i[0].callback&&Ps(i[0].callback,!1),!t)for(let e=0,s=i.length;e<s;++e){const s=i[e];if(!s.complete){t=s.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const s=this.animations_[i];let n=!0;for(let i=0,r=s.length;i<r;++i){const r=s[i];if(r.complete)continue;const o=t-r.start;let a=r.duration>0?o/r.duration:1;a>=1?(r.complete=!0,a=1):n=!1;const l=r.easing(a);if(r.sourceCenter){const t=r.sourceCenter[0],e=r.sourceCenter[1],i=r.targetCenter[0],s=r.targetCenter[1];this.nextCenter_=r.targetCenter;const n=t+l*(i-t),o=e+l*(s-e);this.targetCenter_=[n,o]}if(r.sourceResolution&&r.targetResolution){const t=1===l?r.targetResolution:r.sourceResolution+l*(r.targetResolution-r.sourceResolution);if(r.anchor){const e=this.getViewportSize_(this.getRotation()),i=this.constraints_.resolution(t,0,e,!0);this.targetCenter_=this.calculateCenterZoom(i,r.anchor)}this.nextResolution_=r.targetResolution,this.targetResolution_=t,this.applyTargetState_(!0)}if(void 0!==r.sourceRotation&&void 0!==r.targetRotation){const t=1===l?q(r.targetRotation+Math.PI,2*Math.PI)-Math.PI:r.sourceRotation+l*(r.targetRotation-r.sourceRotation);if(r.anchor){const e=this.constraints_.rotation(t,!0);this.targetCenter_=this.calculateCenterRotate(e,r.anchor)}this.nextRotation_=r.targetRotation,this.targetRotation_=t}if(this.applyTargetState_(!0),e=!0,!r.complete)break}if(n){this.animations_[i]=null,this.setHint(oi,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const t=s[0].callback;t&&Ps(t,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const s=this.getCenterInternal();var n,r;return void 0!==s&&(i=[s[0]-e[0],s[1]-e[1]],function(t,e){const i=Math.cos(e),s=Math.sin(e),n=t[0]*i-t[1]*s,r=t[1]*i+t[0]*s;t[0]=n,t[1]=r}(i,t-this.getRotation()),r=e,(n=i)[0]+=+r[0],n[1]+=+r[1]),i}calculateCenterZoom(t,e){let i;const s=this.getCenterInternal(),n=this.getResolution();if(void 0!==s&&void 0!==n){i=[e[0]-t*(e[0]-s[0])/n,e[1]-t*(e[1]-s[1])/n]}return i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],s=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(s*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t?Ni(t,this.getProjection()):t}getCenterInternal(){return this.get(li.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){return Yi(this.calculateExtentInternal(t),this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();z(e,1);const i=this.getResolution();z(void 0!==i,2);const s=this.getRotation();return z(void 0!==s,3),ee(e,i,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(li.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(zi(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=re(t)/e[0],s=ie(t)/e[1];return Math.max(i,s)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(e/i)/Math.log(t);return function(i){return e/Math.pow(t,i*s)}}getRotation(){return this.get(li.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,n=Math.log(i/s)/e;return function(t){return Math.log(i/t)/e/n}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let s=this.getCenterInternal();const n=this.padding_;if(n){const t=this.getViewportSizeMinusPadding_();s=Ws(s,this.getViewportSize_(),[t[0]/2+n[3],t[1]/2+n[0]],e,i)}return{center:s.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e,i,s=this.minZoom_||0;if(this.resolutions_){const r=n(this.resolutions_,t,1);s=r,e=this.resolutions_[r],i=r==this.resolutions_.length-1?2:e/this.resolutions_[r+1]}else e=this.maxResolution_,i=this.zoomFactor_;return s+Math.log(e/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=j(Math.floor(t),0,this.resolutions_.length-2),i=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(i,j(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(z(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t)){z(!ae(t),25);i=Ds(zi(t,this.getProjection()))}else if("Circle"===t.getType()){const e=zi(t.getExtent(),this.getProjection());i=Ds(e),i.rotate(this.getRotation(),te(e))}else i=t;this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),s=Math.sin(-e),n=t.getFlatCoordinates(),r=t.getStride();let o=1/0,a=1/0,l=-1/0,h=-1/0;for(let t=0,e=n.length;t<e;t+=r){const e=n[t]*i-n[t+1]*s,r=n[t]*s+n[t+1]*i;o=Math.min(o,e),a=Math.min(a,r),l=Math.max(l,e),h=Math.max(h,r)}return[o,a,l,h]}fitInternal(t,e){let i=(e=e||{}).size;i||(i=this.getViewportSizeMinusPadding_());const s=void 0!==e.padding?e.padding:[0,0,0,0],n=void 0!==e.nearest&&e.nearest;let r;r=void 0!==e.minResolution?e.minResolution:void 0!==e.maxZoom?this.getResolutionForZoom(e.maxZoom):0;const o=this.rotatedExtentForGeometry(t);let a=this.getResolutionForExtentInternal(o,[i[0]-s[1]-s[3],i[1]-s[0]-s[2]]);a=isNaN(a)?r:Math.max(a,r),a=this.getConstrainedResolution(a,n?0:1);const l=this.getRotation(),c=Math.sin(l),u=Math.cos(l),d=te(o);d[0]+=(s[1]-s[3])/2*a,d[1]+=(s[0]-s[2])/2*a;const g=d[0]*u-d[1]*c,f=d[1]*u+d[0]*c,_=this.getConstrainedCenter([g,f],a),m=e.callback?e.callback:h;void 0!==e.duration?this.animateInternal({resolution:a,center:_,duration:e.duration,easing:e.easing},m):(this.targetResolution_=a,this.targetCenter_=_,this.applyTargetState_(!1,!0),Ps(m,!0))}centerOn(t,e,i){this.centerOnInternal(Xi(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(Ws(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,s){let n;const r=this.padding_;if(r&&t){const o=this.getViewportSizeMinusPadding_(-i),a=Ws(t,s,[o[0]/2+r[3],o[1]/2+r[0]],e,i);n=[t[0]-a[0],t[1]-a[1]]}return n}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(t){const e=Ni(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Xi(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),n=this.constraints_.resolution(this.targetResolution_*t,0,s,i);e&&(this.targetCenter_=this.calculateCenterZoom(n,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Xi(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(s,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t?Xi(t,this.getProjection()):t)}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,s=this.constraints_.rotation(this.targetRotation_,i),n=this.getViewportSize_(s),r=this.constraints_.resolution(this.targetResolution_,0,n,i),o=this.constraints_.center(this.targetCenter_,r,n,i,this.calculateCenterShift(this.targetCenter_,r,s,n));this.get(li.ROTATION)!==s&&this.set(li.ROTATION,s),this.get(li.RESOLUTION)!==r&&(this.set(li.RESOLUTION,r),this.set("zoom",this.getZoom(),!0)),o&&this.get(li.CENTER)&&Ei(this.get(li.CENTER),o)||this.set(li.CENTER,o),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=void 0!==t?t:200;const s=e||0,n=this.constraints_.rotation(this.targetRotation_),r=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,s,r),a=this.constraints_.center(this.targetCenter_,o,r,!1,this.calculateCenterShift(this.targetCenter_,o,n,r));if(0===t&&!this.cancelAnchor_)return this.targetResolution_=o,this.targetRotation_=n,this.targetCenter_=a,void this.applyTargetState_();i=i||(0===t?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===o&&this.getRotation()===n&&this.getCenterInternal()&&Ei(this.getCenterInternal(),a)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:n,center:a,resolution:o,duration:t,easing:es,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ai,1)}endInteraction(t,e,i){i=i&&Xi(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.getInteracting()&&(this.setHint(ai,-1),this.resolveConstraints(t,e,i))}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}};var Ns=class extends ii{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(ti,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return(t=t||[]).push(this),t}getLayerStatesArray(t){return(t=t||[]).push(this.getLayerState()),t}getSource(){return this.get(ti)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),this.sourceReady_||"ready"!==this.getSource().getState()||(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(x(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=m(t,g,this.handleSourceChange_,this),"ready"===t.getState()&&(this.sourceReady_=!0,setTimeout((()=>{this.dispatchEvent("sourceready")}),0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}isVisible(t){let e;const i=this.getMapInternal();let s;!t&&i&&(t=i.getView()),e=t instanceof Bs?{viewState:t.getState(),extent:t.calculateExtent()}:t,!e.layerStatesArray&&i&&(e.layerStatesArray=i.getLayerGroup().getLayerStatesArray()),s=e.layerStatesArray?e.layerStatesArray.find((t=>t.layer===this)):this.getLayerState();const n=this.getExtent();return function(t,e){if(!t.visible)return!1;const i=e.resolution;if(i<t.minResolution||i>=t.maxResolution)return!1;const s=e.zoom;return s>t.minZoom&&s<=t.maxZoom}(s,e.viewState)&&(!n||oe(n,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const i=this.getSource();if(i&&(e=i.getAttributions()),!e)return[];let s=e(t instanceof Bs?t.getViewStateAndExtent():t);return Array.isArray(s)||(s=[s]),s}render(t,e){const i=this.getRenderer();return i.prepareFrame(t)?(this.rendered=!0,i.renderFrame(t,e)):null}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set(ei,t)}getMapInternal(){return this.get(ei)}setMap(t){this.mapPrecomposeKey_&&(x(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(x(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=m(t,ri,(function(t){const e=t.frameState.layerStatesArray,i=this.getLayerState(!1);z(!e.some((function(t){return t.layer===i.layer})),67),e.push(i)}),this),this.mapRenderKey_=m(this,g,t.render,t),this.changed())}setSource(t){this.set(ti,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};function Xs(t,e,i,s,n){Ys(t,e,i||0,s||t.length-1,n||js)}function Ys(t,e,i,s,n){for(;s>i;){if(s-i>600){var r=s-i+1,o=e-i+1,a=Math.log(r),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(r-l)/r)*(o-r/2<0?-1:1);Ys(t,e,Math.max(i,Math.floor(e-o*l/r+h)),Math.min(s,Math.floor(e+(r-o)*l/r+h)),n)}var c=t[e],u=i,d=s;for(zs(t,i,e),n(t[s],c)>0&&zs(t,i,s);u<d;){for(zs(t,u,d),u++,d--;n(t[u],c)<0;)u++;for(;n(t[d],c)>0;)d--}0===n(t[i],c)?zs(t,i,d):zs(t,++d,s),d<=e&&(i=d+1),e<=d&&(s=d-1)}}function zs(t,e,i){var s=t[e];t[e]=t[i],t[i]=s}function js(t,e){return t<e?-1:t>e?1:0}let Vs=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!sn(t,e))return i;const s=this.toBBox,n=[];for(;e;){for(let r=0;r<e.children.length;r++){const o=e.children[r],a=e.leaf?s(o):o;sn(t,a)&&(e.leaf?i.push(o):en(t,a)?this._all(o,i):n.push(o))}e=n.pop()}return i}collides(t){let e=this.data;if(!sn(t,e))return!1;const i=[];for(;e;){for(let s=0;s<e.children.length;s++){const n=e.children[s],r=e.leaf?this.toBBox(n):n;if(sn(t,r)){if(e.leaf||en(t,r))return!0;i.push(n)}}e=i.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=nn([]),this}remove(t,e){if(!t)return this;let i=this.data;const s=this.toBBox(t),n=[],r=[];let o,a,l;for(;i||n.length;){if(i||(i=n.pop(),a=n[n.length-1],o=r.pop(),l=!0),i.leaf){const s=Zs(t,i.children,e);if(-1!==s)return i.children.splice(s,1),n.push(i),this._condense(n),this}l||i.leaf||!en(i,s)?a?(o++,i=a.children[o],l=!1):i=null:(n.push(i),r.push(o),o=0,a=i,i=i.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,s){const n=i-e+1;let r,o=this._maxEntries;if(n<=o)return r=nn(t.slice(e,i+1)),qs(r,this.toBBox),r;s||(s=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,s-1))),r=nn([]),r.leaf=!1,r.height=s;const a=Math.ceil(n/o),l=a*Math.ceil(Math.sqrt(o));rn(t,e,i,l,this.compareMinX);for(let n=e;n<=i;n+=l){const e=Math.min(n+l-1,i);rn(t,n,e,a,this.compareMinY);for(let i=n;i<=e;i+=a){const n=Math.min(i+a-1,e);r.children.push(this._build(t,i,n,s-1))}}return qs(r,this.toBBox),r}_chooseSubtree(t,e,i,s){for(;s.push(e),!e.leaf&&s.length-1!==i;){let i,s=1/0,o=1/0;for(let a=0;a<e.children.length;a++){const l=e.children[a],h=$s(l),c=(n=t,r=l,(Math.max(r.maxX,n.maxX)-Math.min(r.minX,n.minX))*(Math.max(r.maxY,n.maxY)-Math.min(r.minY,n.minY))-h);c<o?(o=c,s=h<s?h:s,i=l):c===o&&h<s&&(s=h,i=l)}e=i||e.children[0]}var n,r;return e}_insert(t,e,i){const s=i?t:this.toBBox(t),n=[],r=this._chooseSubtree(s,this.data,e,n);for(r.children.push(t),Ks(r,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)}_split(t,e){const i=t[e],s=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,s);const r=this._chooseSplitIndex(i,n,s),o=nn(i.children.splice(r,i.children.length-r));o.height=i.height,o.leaf=i.leaf,qs(i,this.toBBox),qs(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)}_splitRoot(t,e){this.data=nn([t,e]),this.data.height=t.height+1,this.data.leaf=!1,qs(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let s,n=1/0,r=1/0;for(let o=e;o<=i-e;o++){const e=Us(t,0,o,this.toBBox),a=Us(t,o,i,this.toBBox),l=tn(e,a),h=$s(e)+$s(a);l<n?(n=l,s=o,r=h<r?h:r):l===n&&h<r&&(r=h,s=o)}return s||i-e}_chooseSplitAxis(t,e,i){const s=t.leaf?this.compareMinX:Hs,n=t.leaf?this.compareMinY:Js;this._allDistMargin(t,e,i,s)<this._allDistMargin(t,e,i,n)&&t.children.sort(s)}_allDistMargin(t,e,i,s){t.children.sort(s);const n=this.toBBox,r=Us(t,0,e,n),o=Us(t,i-e,i,n);let a=Qs(r)+Qs(o);for(let s=e;s<i-e;s++){const e=t.children[s];Ks(r,t.leaf?n(e):e),a+=Qs(r)}for(let s=i-e-1;s>=e;s--){const e=t.children[s];Ks(o,t.leaf?n(e):e),a+=Qs(o)}return a}_adjustParentBBoxes(t,e,i){for(let s=i;s>=0;s--)Ks(e[s],t)}_condense(t){for(let e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children,e.splice(e.indexOf(t[i]),1)):this.clear():qs(t[i],this.toBBox)}};function Zs(t,e,i){if(!i)return e.indexOf(t);for(let s=0;s<e.length;s++)if(i(t,e[s]))return s;return-1}function qs(t,e){Us(t,0,t.children.length,e,t)}function Us(t,e,i,s,n){n||(n=nn(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=e;r<i;r++){const e=t.children[r];Ks(n,t.leaf?s(e):e)}return n}function Ks(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Hs(t,e){return t.minX-e.minX}function Js(t,e){return t.minY-e.minY}function $s(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Qs(t){return t.maxX-t.minX+(t.maxY-t.minY)}function tn(t,e){const i=Math.max(t.minX,e.minX),s=Math.max(t.minY,e.minY),n=Math.min(t.maxX,e.maxX),r=Math.min(t.maxY,e.maxY);return Math.max(0,n-i)*Math.max(0,r-s)}function en(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function sn(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function nn(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function rn(t,e,i,s,n){const r=[e,i];for(;r.length;){if((i=r.pop())-(e=r.pop())<=s)continue;const o=e+Math.ceil((i-e)/s/2)*s;Xs(t,o,e,i,n),r.push(e,o,o,i)}}class on{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=G(void 0!==t.scale?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=void 0!==t.fill?t.fill:new kt({color:"#333"}),this.maxAngle_=void 0!==t.maxAngle?t.maxAngle:Math.PI/4,this.placement_=void 0!==t.placement?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=void 0!==t.stroke?t.stroke:null,this.offsetX_=void 0!==t.offsetX?t.offsetX:0,this.offsetY_=void 0!==t.offsetY?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=void 0===t.padding?null:t.padding}clone(){const t=this.getScale();return new on({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=G(void 0!==t?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}var an=on;function ln(t){return new Gt({fill:hn(t,""),stroke:cn(t,""),text:un(t),image:dn(t)})}function hn(t,e){const i=t[e+"fill-color"];if(i)return"none"===i?null:new kt({color:i})}function cn(t,e){const i=t[e+"stroke-width"],s=t[e+"stroke-color"];if(i||s)return new Ft({width:i,color:s,lineCap:t[e+"stroke-line-cap"],lineJoin:t[e+"stroke-line-join"],lineDash:t[e+"stroke-line-dash"],lineDashOffset:t[e+"stroke-line-dash-offset"],miterLimit:t[e+"stroke-miter-limit"]})}function un(t){const e=t["text-value"];if(!e)return;return new an({text:e,font:t["text-font"],maxAngle:t["text-max-angle"],offsetX:t["text-offset-x"],offsetY:t["text-offset-y"],overflow:t["text-overflow"],placement:t["text-placement"],repeat:t["text-repeat"],scale:t["text-scale"],rotateWithView:t["text-rotate-with-view"],rotation:t["text-rotation"],textAlign:t["text-align"],justify:t["text-justify"],textBaseline:t["text-baseline"],padding:t["text-padding"],fill:hn(t,"text-"),backgroundFill:hn(t,"text-background-"),stroke:cn(t,"text-"),backgroundStroke:cn(t,"text-background-")})}function dn(t){const e=t["icon-src"],i=t["icon-img"];if(e||i){return new fe({src:e,img:i,imgSize:t["icon-img-size"],anchor:t["icon-anchor"],anchorOrigin:t["icon-anchor-origin"],anchorXUnits:t["icon-anchor-x-units"],anchorYUnits:t["icon-anchor-y-units"],color:t["icon-color"],crossOrigin:t["icon-cross-origin"],offset:t["icon-offset"],displacement:t["icon-displacement"],opacity:t["icon-opacity"],scale:t["icon-scale"],width:t["icon-width"],height:t["icon-height"],rotation:t["icon-rotation"],rotateWithView:t["icon-rotate-with-view"],size:t["icon-size"],declutterMode:t["icon-declutter-mode"]})}const s=t["shape-points"];if(s){const e="shape-";return new Mt({points:s,fill:hn(t,e),stroke:cn(t,e),radius:t["shape-radius"],radius1:t["shape-radius1"],radius2:t["shape-radius2"],angle:t["shape-angle"],displacement:t["shape-displacement"],rotation:t["shape-rotation"],rotateWithView:t["shape-rotate-with-view"],scale:t["shape-scale"],declutterMode:t["shape-declutter-mode"]})}const n=t["circle-radius"];if(n){const e="circle-";return new bt({radius:n,fill:hn(t,e),stroke:cn(t,e),displacement:t["circle-displacement"],scale:t["circle-scale"],rotation:t["circle-rotation"],rotateWithView:t["circle-rotate-with-view"],declutterMode:t["circle-declutter-mode"]})}}const gn="renderOrder";var fn=class extends Ns{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=void 0!==t.declutter&&t.declutter,this.renderBuffer_=void 0!==t.renderBuffer?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=void 0!==t.updateWhileAnimating&&t.updateWhileAnimating,this.updateWhileInteracting_=void 0!==t.updateWhileInteracting&&t.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(gn)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new Vs(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set(gn,t)}setStyle(t){let e;if(void 0===t)e=Dt;else if(null===t)e=null;else if("function"==typeof t)e=t;else if(t instanceof Gt)e=t;else if(Array.isArray(t)){const i=t.length,s=new Array(i);for(let e=0;e<i;++e){const i=t[e];s[e]=i instanceof Gt?i:ln(i)}e=s}else e=ln(t);this.style_=e,this.styleFunction_=null===t?void 0:function(t){let e;if("function"==typeof t)e=t;else{let i;Array.isArray(t)?i=t:(z("function"==typeof t.getZIndex,41),i=[t]),e=function(){return i}}return e}(this.style_),this.changed()}};const _n={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},mn=[_n.FILL],pn=[_n.STROKE],xn=[_n.BEGIN_PATH],yn=[_n.CLOSE_PATH];var vn=_n;var Sn=class{drawCustom(t,e,i,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}};var Cn=class extends Sn{constructor(t,e,i,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return 1==e?t:t.map((function(t){return t*e}))}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,n=this.coordinates;let r=n.length;for(let o=0,a=t.length;o<a;o+=e)s[0]=t[o],s[1]=t[o+1],zt(i,s)&&(n[r++]=s[0],n[r++]=s[1]);return r}appendFlatLineCoordinates(t,e,i,s,n,r){const o=this.coordinates;let a=o.length;const l=this.getBufferedMaxExtent();r&&(e+=s);let h=t[e],c=t[e+1];const u=this.tmpCoordinate_;let d,g,f,_=!0;for(d=e+s;d<i;d+=s)u[0]=t[d],u[1]=t[d+1],f=Zt(l,u),f!==g?(_&&(o[a++]=h,o[a++]=c,_=!1),o[a++]=u[0],o[a++]=u[1]):f===Nt.INTERSECTING?(o[a++]=u[0],o[a++]=u[1],_=!1):_=!0,h=u[0],c=u[1],g=f;return(n&&_||d===e+s)&&(o[a++]=h,o[a++]=c),a}drawCustomCoordinates_(t,e,i,s,n){for(let r=0,o=i.length;r<o;++r){const o=i[r],a=this.appendFlatLineCoordinates(t,e,o,s,!1,!1);n.push(a),e=o}return e}drawCustom(t,e,i,s){this.beginGeometry(t,e);const n=t.getType(),r=t.getStride(),o=this.coordinates.length;let a,l,h,c,u;switch(n){case"MultiPolygon":a=t.getOrientedFlatCoordinates(),c=[];const e=t.getEndss();u=0;for(let t=0,i=e.length;t<i;++t){const i=[];u=this.drawCustomCoordinates_(a,u,e[t],r,i),c.push(i)}this.instructions.push([vn.CUSTOM,o,c,t,i,vs]),this.hitDetectionInstructions.push([vn.CUSTOM,o,c,t,s||i,vs]);break;case"Polygon":case"MultiLineString":h=[],a="Polygon"==n?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),u=this.drawCustomCoordinates_(a,0,t.getEnds(),r,h),this.instructions.push([vn.CUSTOM,o,h,t,i,ys]),this.hitDetectionInstructions.push([vn.CUSTOM,o,h,t,s||i,ys]);break;case"LineString":case"Circle":a=t.getFlatCoordinates(),l=this.appendFlatLineCoordinates(a,0,a.length,r,!1,!1),this.instructions.push([vn.CUSTOM,o,l,t,i,xs]),this.hitDetectionInstructions.push([vn.CUSTOM,o,l,t,s||i,xs]);break;case"MultiPoint":a=t.getFlatCoordinates(),l=this.appendFlatPointCoordinates(a,r),l>o&&(this.instructions.push([vn.CUSTOM,o,l,t,i,xs]),this.hitDetectionInstructions.push([vn.CUSTOM,o,l,t,s||i,xs]));break;case"Point":a=t.getFlatCoordinates(),this.coordinates.push(a[0],a[1]),l=this.coordinates.length,this.instructions.push([vn.CUSTOM,o,l,t,i]),this.hitDetectionInstructions.push([vn.CUSTOM,o,l,t,s||i])}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[vn.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[vn.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;let e;t.reverse();const i=t.length;let s,n,o=-1;for(e=0;e<i;++e)s=t[e],n=s[0],n==vn.END_GEOMETRY?o=e:n==vn.BEGIN_GEOMETRY&&(s[2]=e,r(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const e=t.getColor();i.fillStyle=it(e||at)}else i.fillStyle=void 0;if(e){const t=e.getColor();i.strokeStyle=it(t||ut);const s=e.getLineCap();i.lineCap=void 0!==s?s:lt;const n=e.getLineDash();i.lineDash=n?n.slice():ht;const r=e.getLineDashOffset();i.lineDashOffset=r||0;const o=e.getLineJoin();i.lineJoin=void 0!==o?o:ct;const a=e.getWidth();i.lineWidth=void 0!==a?a:1;const l=e.getMiterLimit();i.miterLimit=void 0!==l?l:10,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[vn.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(!0),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[vn.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;"string"==typeof i&&t.currentFillStyle==i||(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,s=t.lineCap,n=t.lineDash,r=t.lineDashOffset,o=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=s||n!=t.currentLineDash&&!a(t.currentLineDash,n)||t.currentLineDashOffset!=r||t.currentLineJoin!=o||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=s,t.currentLineDash=n,t.currentLineDashOffset=r,t.currentLineJoin=o,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[vn.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=(t=this.maxExtent,e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Xt(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}var t,e;return this.bufferedMaxExtent_}};var Rn=class extends Cn{constructor(t,e,i,s){super(t,e,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),s=t.getStride(),n=this.coordinates.length,r=this.appendFlatPointCoordinates(i,s);this.instructions.push([vn.DRAW_IMAGE,n,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([vn.DRAW_IMAGE,n,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),s=t.getStride(),n=this.coordinates.length,r=this.appendFlatPointCoordinates(i,s);this.instructions.push([vn.DRAW_IMAGE,n,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([vn.DRAW_IMAGE,n,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),s=t.getSize(),n=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=n[0],this.originY_=n[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}};var wn=class extends Cn{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinates_(t,e,i,s){const n=this.coordinates.length,r=this.appendFlatLineCoordinates(t,e,i,s,!1,!1),o=[vn.MOVE_TO_LINE_TO,n,r];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e){const i=this.state,s=i.strokeStyle,n=i.lineWidth;if(void 0===s||void 0===n)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([vn.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,ht,0],xn);const r=t.getFlatCoordinates(),o=t.getStride();this.drawFlatCoordinates_(r,0,r.length,o),this.hitDetectionInstructions.push(pn),this.endGeometry(e)}drawMultiLineString(t,e){const i=this.state,s=i.strokeStyle,n=i.lineWidth;if(void 0===s||void 0===n)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([vn.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,ht,0],xn);const r=t.getEnds(),o=t.getFlatCoordinates(),a=t.getStride();let l=0;for(let t=0,e=r.length;t<e;++t)l=this.drawFlatCoordinates_(o,l,r[t],a);this.hitDetectionInstructions.push(pn),this.endGeometry(e)}finish(){const t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(pn),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(pn),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(xn)}};var In=class extends Cn{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinatess_(t,e,i,s){const n=this.state,r=void 0!==n.fillStyle,o=void 0!==n.strokeStyle,a=i.length;this.instructions.push(xn),this.hitDetectionInstructions.push(xn);for(let n=0;n<a;++n){const r=i[n],a=this.coordinates.length,l=this.appendFlatLineCoordinates(t,e,r,s,!0,!o),h=[vn.MOVE_TO_LINE_TO,a,l];this.instructions.push(h),this.hitDetectionInstructions.push(h),o&&(this.instructions.push(yn),this.hitDetectionInstructions.push(yn)),e=r}return r&&(this.instructions.push(mn),this.hitDetectionInstructions.push(mn)),o&&(this.instructions.push(pn),this.hitDetectionInstructions.push(pn)),e}drawCircle(t,e){const i=this.state,s=i.fillStyle,n=i.strokeStyle;if(void 0===s&&void 0===n)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([vn.SET_FILL_STYLE,at]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([vn.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,ht,0]);const r=t.getFlatCoordinates(),o=t.getStride(),a=this.coordinates.length;this.appendFlatLineCoordinates(r,0,r.length,o,!1,!1);const l=[vn.CIRCLE,a];this.instructions.push(xn,l),this.hitDetectionInstructions.push(xn,l),void 0!==i.fillStyle&&(this.instructions.push(mn),this.hitDetectionInstructions.push(mn)),void 0!==i.strokeStyle&&(this.instructions.push(pn),this.hitDetectionInstructions.push(pn)),this.endGeometry(e)}drawPolygon(t,e){const i=this.state,s=i.fillStyle,n=i.strokeStyle;if(void 0===s&&void 0===n)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([vn.SET_FILL_STYLE,at]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([vn.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,ht,0]);const r=t.getEnds(),o=t.getOrientedFlatCoordinates(),a=t.getStride();this.drawFlatCoordinatess_(o,0,r,a),this.endGeometry(e)}drawMultiPolygon(t,e){const i=this.state,s=i.fillStyle,n=i.strokeStyle;if(void 0===s&&void 0===n)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([vn.SET_FILL_STYLE,at]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([vn.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,ht,0]);const r=t.getEndss(),o=t.getOrientedFlatCoordinates(),a=t.getStride();let l=0;for(let t=0,e=r.length;t<e;++t)l=this.drawFlatCoordinatess_(o,l,r[t],a);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(0!==t){const e=this.coordinates;for(let i=0,s=e.length;i<s;++i)e[i]=ms(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}};function Mn(t,e,i,s,n){const r=[];let o=i,a=0,l=e.slice(i,2);for(;a<t&&o+n<s;){const[i,s]=l.slice(-2),h=e[o+n],c=e[o+n+1],u=Math.sqrt((h-i)*(h-i)+(c-s)*(c-s));if(a+=u,a>=t){const e=(t-a+u)/u,d=U(i,h,e),g=U(s,c,e);l.push(d,g),r.push(l),l=[d,g],a==t&&(o+=n),a=0}else if(a<t)l.push(e[o+n],e[o+n+1]),o+=n;else{const t=u-a,e=U(i,h,t/u),d=U(s,c,t/u);l.push(e,d),r.push(l),l=[e,d],a=0,o+=n}}return a>0&&r.push(l),r}function En(t,e,i,s,n){let r,o,a,l,h,c,u,d,g,f,_=i,m=i,p=0,x=0,y=i;for(o=i;o<s;o+=n){const i=e[o],s=e[o+1];void 0!==h&&(g=i-h,f=s-c,l=Math.sqrt(g*g+f*f),void 0!==u&&(x+=a,r=Math.acos((u*g+d*f)/(a*l)),r>t&&(x>p&&(p=x,_=y,m=o),x=0,y=o-n)),a=l,u=g,d=f),h=i,c=s}return x+=l,x>p?[y,o]:[_,m]}const bn={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};const Tn={Circle:In,Default:Cn,Image:Rn,LineString:wn,Polygon:In,Text:class extends Cn{constructor(t,e,i,s){super(t,e,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[at]={fillStyle:at},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const i=this.textFillState_,s=this.textStrokeState_,n=this.textState_;if(""===this.text_||!n||!i&&!s)return;const r=this.coordinates;let o=r.length;const a=t.getType();let l=null,h=t.getStride();if("line"!==n.placement||"LineString"!=a&&"MultiLineString"!=a&&"Polygon"!=a&&"MultiPolygon"!=a){let i=n.overflow?null:[];switch(a){case"Point":case"MultiPoint":l=t.getFlatCoordinates();break;case"LineString":l=t.getFlatMidpoint();break;case"Circle":l=t.getCenter();break;case"MultiLineString":l=t.getFlatMidpoints(),h=2;break;case"Polygon":l=t.getFlatInteriorPoint(),n.overflow||i.push(l[2]/this.resolution),h=3;break;case"MultiPolygon":const e=t.getFlatInteriorPoints();l=[];for(let t=0,s=e.length;t<s;t+=3)n.overflow||i.push(e[t+2]/this.resolution),l.push(e[t],e[t+1]);if(0===l.length)return;h=2}const s=this.appendFlatPointCoordinates(l,h);if(s===o)return;if(i&&(s-o)/2!=l.length/h){let t=o/2;i=i.filter(((e,i)=>{const s=r[2*(t+i)]===l[i*h]&&r[2*(t+i)+1]===l[i*h+1];return s||--t,s}))}this.saveTextStates_(),(n.backgroundFill||n.backgroundStroke)&&(this.setFillStrokeStyle(n.backgroundFill,n.backgroundStroke),n.backgroundFill&&this.updateFillStyle(this.state,this.createFill),n.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);let c=n.padding;if(c!=ft&&(n.scale[0]<0||n.scale[1]<0)){let t=n.padding[0],e=n.padding[1],i=n.padding[2],s=n.padding[3];n.scale[0]<0&&(e=-e,s=-s),n.scale[1]<0&&(t=-t,i=-i),c=[t,e,i,s]}const u=this.pixelRatio;this.instructions.push([vn.DRAW_IMAGE,o,s,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,c==ft?ft:c.map((function(t){return t*u})),!!n.backgroundFill,!!n.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,i]);const d=1/u,g=this.state.fillStyle;n.backgroundFill&&(this.state.fillStyle=at,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([vn.DRAW_IMAGE,o,s,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[d,d],NaN,void 0,this.declutterImageWithText_,c,!!n.backgroundFill,!!n.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?at:this.fillKey_,this.textOffsetX_,this.textOffsetY_,i]),n.backgroundFill&&(this.state.fillStyle=g,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}else{if(!oe(this.getBufferedMaxExtent(),t.getExtent()))return;let i;if(l=t.getFlatCoordinates(),"LineString"==a)i=[l.length];else if("MultiLineString"==a)i=t.getEnds();else if("Polygon"==a)i=t.getEnds().slice(0,1);else if("MultiPolygon"==a){const e=t.getEndss();i=[];for(let t=0,s=e.length;t<s;++t)i.push(e[t][0])}this.beginGeometry(t,e);const s=n.repeat,c=s?void 0:n.textAlign;let u=0;for(let t=0,e=i.length;t<e;++t){let e;e=s?Mn(s*this.resolution,l,u,i[t],h):[l.slice(u,i[t])];for(let s=0,a=e.length;s<a;++s){const a=e[s];let l=0,d=a.length;if(null==c){const t=En(n.maxAngle,a,0,a.length,2);l=t[0],d=t[1]}for(let t=l;t<d;t+=h)r.push(a[t],a[t+1]);const g=r.length;u=i[t],this.drawChars_(o,g),o=g}}this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const n=this.textKey_;n in this.textStates||(this.textStates[n]={font:e.font,textAlign:e.textAlign||dt,justify:e.justify,textBaseline:e.textBaseline||gt,scale:e.scale});const r=this.fillKey_;i&&(r in this.fillStates||(this.fillStates[r]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,s=this.textState_,n=this.strokeKey_,r=this.textKey_,o=this.fillKey_;this.saveTextStates_();const a=this.pixelRatio,l=bn[s.textBaseline],h=this.textOffsetY_*a,c=this.text_,u=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([vn.DRAW_CHARS,t,e,l,s.overflow,o,s.maxAngle,a,h,n,u*a,c,r,1]),this.hitDetectionInstructions.push([vn.DRAW_CHARS,t,e,l,s.overflow,o?at:o,s.maxAngle,1,h,n,u,c,r,1/a])}setTextStyle(t,e){let i,s,n;if(t){const e=t.getFill();e?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=it(e.getColor()||at)):(s=null,this.textFillState_=s);const r=t.getStroke();if(r){n=this.textStrokeState_,n||(n={},this.textStrokeState_=n);const t=r.getLineDash(),e=r.getLineDashOffset(),i=r.getWidth(),s=r.getMiterLimit();n.lineCap=r.getLineCap()||lt,n.lineDash=t?t.slice():ht,n.lineDashOffset=void 0===e?0:e,n.lineJoin=r.getLineJoin()||ct,n.lineWidth=void 0===i?1:i,n.miterLimit=void 0===s?10:s,n.strokeStyle=it(r.getColor()||ut)}else n=null,this.textStrokeState_=n;i=this.textState_;const o=t.getFont()||ot;yt(o);const a=t.getScaleArray();i.overflow=t.getOverflow(),i.font=o,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||gt,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||ft,i.scale=void 0===a?[1,1]:a;const l=t.getOffsetX(),h=t.getOffsetY(),c=t.getRotateWithView(),u=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===l?0:l,this.textOffsetY_=void 0===h?0:h,this.textRotateWithView_=void 0!==c&&c,this.textRotation_=void 0===u?0:u,this.strokeKey_=n?("string"==typeof n.strokeStyle?n.strokeStyle:R(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s?"string"==typeof s.fillStyle?s.fillStyle:"|"+R(s.fillStyle):""}else this.text_="";this.declutterImageWithText_=e}}};var kn=class{constructor(t,e,i,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const s in i){const n=i[s].finish();t[e][s]=n}}return t}getBuilder(t,e){const i=void 0!==t?t.toString():"0";let s=this.buildersByZIndex_[i];void 0===s&&(s={},this.buildersByZIndex_[i]=s);let n=s[e];if(void 0===n){n=new(0,Tn[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=n}return n}};var Ln=class extends v{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return S()}getData(t){return null}prepareFrame(t){return S()}renderFrame(t,e){return S()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(s,n)=>{const r=this.loadedTileCallback.bind(this,i,s);return t.forEachLoadedTile(e,s,n,r)}}forEachFeatureAtCoordinate(t,e,i,s,n){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;e.getState()!==D&&e.getState()!==P||this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=D&&e!=P&&t.addEventListener(g,this.boundHandleImageChange_),e==A&&(t.load(),e=t.getState()),e==D}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&"ready"===t.getSourceState()&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}};var Fn=class extends t{constructor(t,e,i,s){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=s}};const An=[];let On=null;var Dn=class extends Ln{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){let s;On||(On=k(1,1,void 0,{willReadFrequently:!0})),On.clearRect(0,0,1,1);try{On.drawImage(t,e,i,1,1,0,0,1,1),s=On.getImageData(0,0,1,1).data}catch(t){return On=null,null}return s}getBackground(t){let e=this.getLayer().getBackground();return"function"==typeof e&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,i){const s=this.getLayer().getClassName();let n,r;if(t&&t.className===s&&(!i||t&&t.style.backgroundColor&&a(Q(t.style.backgroundColor),Q(i)))){const e=t.firstElementChild;e instanceof HTMLCanvasElement&&(r=e.getContext("2d"))}if(r&&r.canvas.style.transform===e?(this.container=t,this.context=r,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){n=document.createElement("div"),n.className=s;let t=n.style;t.position="absolute",t.width="100%",t.height="100%",r=k();const e=r.canvas;n.appendChild(e),t=e.style,t.position="absolute",t.left="0",t.transformOrigin="top left",this.container=n,this.context=r}this.containerReused||!i||this.container.style.backgroundColor||(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const s=se(i),n=ne(i),r=Qt(i),o=$t(i);ss(e.coordinateToPixelTransform,s),ss(e.coordinateToPixelTransform,n),ss(e.coordinateToPixelTransform,r),ss(e.coordinateToPixelTransform,o);const a=this.inversePixelTransform;ss(a,s),ss(a,n),ss(a,r),ss(a,o),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()}dispatchRenderEvent_(t,e,i){const s=this.getLayer();if(s.hasListener(t)){const n=new Fn(t,this.inversePixelTransform,i,e);s.dispatchEvent(n)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_(si,t,e)}postRender(t,e){this.dispatchRenderEvent_(ni,t,e)}getRenderTransform(t,e,i,s,n,r,o){const a=n/2,l=r/2,h=s/e,c=-h,u=-t[0]+o,d=-t[1];return ns(this.tempTransform,a,l,h,c,-i,u,d)}disposeInternal(){delete this.frameState,super.disposeInternal()}};function Pn(t,e,i,s,n,r,o,a,l,h,c,u){let d=t[e],g=t[e+1],f=0,_=0,m=0,p=0;function x(){f=d,_=g,d=t[e+=s],g=t[e+1],p+=m,m=Math.sqrt((d-f)*(d-f)+(g-_)*(g-_))}do{x()}while(e<i-s&&p+m<r);let y=0===m?0:(r-p)/m;const v=U(f,d,y),S=U(_,g,y),C=e-s,R=p,w=r+a*l(h,n,c);for(;e<i-s&&p+m<w;)x();y=0===m?0:(w-p)/m;const I=U(f,d,y),M=U(_,g,y);let E;if(u){const t=[v,S,I,M];as(t,0,4,2,u,t,t),E=t[0]>t[2]}else E=v>I;const b=Math.PI,T=[],k=C+s===e;let L;if(m=0,p=R,d=t[e=C],g=t[e+1],k){x(),L=Math.atan2(g-_,d-f),E&&(L+=L>0?-b:b);const t=(I+v)/2,e=(M+S)/2;return T[0]=[t,e,(w-r)/2,L,n],T}for(let t=0,u=(n=n.replace(/\n/g," ")).length;t<u;){x();let v=Math.atan2(g-_,d-f);if(E&&(v+=v>0?-b:b),void 0!==L){let t=v-L;if(t+=t>b?-2*b:t<-b?2*b:0,Math.abs(t)>o)return null}L=v;const S=t;let C=0;for(;t<u;++t){const o=a*l(h,n[E?u-t-1:t],c);if(e+s<i&&p+m<r+C+o/2)break;C+=o}if(t===S)continue;const R=E?n.substring(u-S,u-t):n.substring(S,t);y=0===m?0:(r+C/2-p)/m;const w=U(f,d,y),I=U(_,g,y);T.push([w,I,C/2,v,R]),r+=C}return T}function Gn(t,e,i,s){let n=t[e],r=t[e+1],o=0;for(let a=e+s;a<i;a+=s){const e=t[a],i=t[a+1];o+=Math.sqrt((e-n)*(e-n)+(i-r)*(i-r)),n=e,r=i}return o}const Wn=[1/0,1/0,-1/0,-1/0],Bn=[],Nn=[],Xn=[],Yn=[];function zn(t){return t[3].declutterBox}const jn=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Vn(t,e){return"start"===e?e=jn.test(t)?"right":"left":"end"===e&&(e=jn.test(t)?"left":"right"),bn[e]}function Zn(t,e,i){return i>0&&t.push("\n",""),t.push(e,""),t}var qn=class{constructor(t,e,i,s){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,i,s){const n=t+e+i+s;if(this.labels_[n])return this.labels_[n];const r=s?this.strokeStates[s]:null,o=i?this.fillStates[i]:null,a=this.textStates[e],l=this.pixelRatio,h=[a.scale[0]*l,a.scale[1]*l],c=Array.isArray(t),u=a.justify?bn[a.justify]:Vn(Array.isArray(t)?t[0]:t,a.textAlign||dt),d=s&&r.lineWidth?r.lineWidth:0,g=c?t:t.split("\n").reduce(Zn,[]),{width:f,height:_,widths:m,heights:p,lineWidths:x}=function(t,e){const i=[],s=[],n=[];let r=0,o=0,a=0,l=0;for(let h=0,c=e.length;h<=c;h+=2){const u=e[h];if("\n"===u||h===c){r=Math.max(r,o),n.push(o),o=0,a+=l;continue}const d=e[h+1]||t.font,g=Ct(d,u);i.push(g),o+=g;const f=vt(d);s.push(f),l=Math.max(l,f)}return{width:r,height:a,widths:i,heights:s,lineWidths:n}}(a,g),y=f+d,v=[],S=(y+2)*h[0],C=(_+d)*h[1],R={width:S<0?Math.floor(S):Math.ceil(S),height:C<0?Math.floor(C):Math.ceil(C),contextInstructions:v};1==h[0]&&1==h[1]||v.push("scale",h),s&&(v.push("strokeStyle",r.strokeStyle),v.push("lineWidth",d),v.push("lineCap",r.lineCap),v.push("lineJoin",r.lineJoin),v.push("miterLimit",r.miterLimit),v.push("setLineDash",[r.lineDash]),v.push("lineDashOffset",r.lineDashOffset)),i&&v.push("fillStyle",o.fillStyle),v.push("textBaseline","middle"),v.push("textAlign","center");const w=.5-u;let I=u*y+w*d;const M=[],E=[];let b,T=0,k=0,L=0,F=0;for(let t=0,e=g.length;t<e;t+=2){const e=g[t];if("\n"===e){k+=T,T=0,I=u*y+w*d,++F;continue}const n=g[t+1]||a.font;n!==b&&(s&&M.push("font",n),i&&E.push("font",n),b=n),T=Math.max(T,p[L]);const r=[e,I+w*m[L]+u*(m[L]-x[F]),.5*(d+T)+k];I+=m[L],s&&M.push("strokeText",r),i&&E.push("fillText",r),++L}return Array.prototype.push.apply(v,M),Array.prototype.push.apply(v,E),this.labels_[n]=R,R}replayTextBackground_(t,e,i,s,n,r,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,n),t.lineTo.apply(t,e),r&&(this.alignFill_=r[2],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,s,n,r,o,a,l,h,c,u,d,g,f,_){let m=i-(o*=u[0]),p=s-(a*=u[1]);const x=n+l>t?t-l:n,y=r+h>e?e-h:r,v=g[3]+x*u[0]+g[1],S=g[0]+y*u[1]+g[2],C=m-g[3],R=p-g[0];let w;return(f||0!==c)&&(Bn[0]=C,Yn[0]=C,Bn[1]=R,Nn[1]=R,Nn[0]=C+v,Xn[0]=Nn[0],Xn[1]=R+S,Yn[1]=Xn[1]),0!==c?(w=ns([1,0,0,1,0,0],i,s,1,1,c,-i,-s),ss(w,Bn),ss(w,Nn),ss(w,Xn),ss(w,Yn),qt(Math.min(Bn[0],Nn[0],Xn[0],Yn[0]),Math.min(Bn[1],Nn[1],Xn[1],Yn[1]),Math.max(Bn[0],Nn[0],Xn[0],Yn[0]),Math.max(Bn[1],Nn[1],Xn[1],Yn[1]),Wn)):qt(Math.min(C,C+v),Math.min(R,R+S),Math.max(C,C+v),Math.max(R,R+S),Wn),d&&(m=Math.round(m),p=Math.round(p)),{drawImageX:m,drawImageY:p,drawImageW:x,drawImageH:y,originX:l,originY:h,declutterBox:{minX:Wn[0],minY:Wn[1],maxX:Wn[2],maxY:Wn[3],value:_},canvasTransform:w,scale:u}}replayImageOrLabel_(t,e,i,s,n,r,o){const a=!(!r&&!o),l=s.declutterBox,h=t.canvas,c=o?o[2]*s.scale[0]/2:0;return l.minX-c<=h.width/e&&l.maxX+c>=0&&l.minY-c<=h.height/e&&l.maxY+c>=0&&(a&&this.replayTextBackground_(t,Bn,Nn,Xn,Yn,r,o),wt(t,s.canvasTransform,n,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){if(this.alignFill_){const e=ss(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,s){const n=this.textStates[e],r=this.createLabel(t,e,s,i),o=this.strokeStates[i],a=this.pixelRatio,l=Vn(Array.isArray(t)?t[0]:t,n.textAlign||dt),h=bn[n.textBaseline||gt],c=o&&o.lineWidth?o.lineWidth:0;return{label:r,anchorX:l*(r.width/a-2*n.scale[0])+2*(.5-l)*c,anchorY:h*r.height/a+2*(.5-h)*c}}execute_(t,e,i,s,n,r,o,l){let h;var c,u;this.pixelCoordinates_&&a(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=os(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),c=this.renderedTransform_,u=i,c[0]=u[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5]);let d=0;const g=s.length;let f,_,m,p,x,y,v,S,C,R,w,I,M=0,E=0,b=0,T=null,k=null;const L=this.coordinateCache_,F=this.viewRotation_,A=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,O={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:F},D=this.instructions!=s||this.overlaps?0:200;let P,G,W,B;for(;d<g;){const i=s[d];switch(i[0]){case vn.BEGIN_GEOMETRY:P=i[1],B=i[3],P.getGeometry()?void 0===o||oe(o,B.getExtent())?++d:d=i[2]+1:d=i[2];break;case vn.BEGIN_PATH:E>D&&(this.fill_(t),E=0),b>D&&(t.stroke(),b=0),E||b||(t.beginPath(),p=NaN,x=NaN),++d;break;case vn.CIRCLE:M=i[1];const s=h[M],a=h[M+1],c=h[M+2]-s,u=h[M+3]-a,g=Math.sqrt(c*c+u*u);t.moveTo(s+g,a),t.arc(s,a,g,0,2*Math.PI,!0),++d;break;case vn.CLOSE_PATH:t.closePath(),++d;break;case vn.CUSTOM:M=i[1],f=i[2];const N=i[3],X=i[4],Y=6==i.length?i[5]:void 0;O.geometry=N,O.feature=P,d in L||(L[d]=[]);const z=L[d];Y?Y(h,M,f,2,z):(z[0]=h[M],z[1]=h[M+1],z.length=2),X(z,O),++d;break;case vn.DRAW_IMAGE:M=i[1],f=i[2],S=i[3],_=i[4],m=i[5];let j=i[6];const V=i[7],Z=i[8],q=i[9],U=i[10];let K=i[11];const H=i[12];let J=i[13];const $=i[14],Q=i[15];if(!S&&i.length>=20){C=i[19],R=i[20],w=i[21],I=i[22];const t=this.drawLabelWithPointPlacement_(C,R,w,I);S=t.label,i[3]=S;const e=i[23];_=(t.anchorX-e)*this.pixelRatio,i[4]=_;const s=i[24];m=(t.anchorY-s)*this.pixelRatio,i[5]=m,j=S.height,i[6]=j,J=S.width,i[13]=J}let tt,et,it,st;i.length>25&&(tt=i[25]),i.length>17?(et=i[16],it=i[17],st=i[18]):(et=ft,it=!1,st=!1),U&&A?K+=F:U||A||(K-=F);let nt=0;for(;M<f;M+=2){if(tt&&tt[nt++]<J/this.pixelRatio)continue;const i=this.calculateImageOrLabelDimensions_(S.width,S.height,h[M],h[M+1],J,j,_,m,Z,q,K,H,n,et,it||st,P),s=[t,e,S,i,V,it?T:null,st?k:null];if(l){if("none"===$)continue;if("obstacle"===$){l.insert(i.declutterBox);continue}{let t,e;if(Q){const i=f-M;if(!Q[i]){Q[i]=s;continue}if(t=Q[i],delete Q[i],e=zn(t),l.collides(e))continue}if(l.collides(i.declutterBox))continue;t&&(l.insert(e),this.replayImageOrLabel_.apply(this,t)),l.insert(i.declutterBox)}}this.replayImageOrLabel_.apply(this,s)}++d;break;case vn.DRAW_CHARS:const rt=i[1],ot=i[2],at=i[3],lt=i[4];I=i[5];const ht=i[6],ct=i[7],ut=i[8];w=i[9];const dt=i[10];C=i[11],R=i[12];const gt=[i[13],i[13]],_t=this.textStates[R],mt=_t.font,pt=[_t.scale[0]*ct,_t.scale[1]*ct];let xt;mt in this.widths_?xt=this.widths_[mt]:(xt={},this.widths_[mt]=xt);const yt=Gn(h,rt,ot,2),vt=Math.abs(pt[0])*Rt(mt,C,xt);if(lt||vt<=yt){const i=Pn(h,rt,ot,2,C,(yt-vt)*Vn(C,this.textStates[R].textAlign),ht,Math.abs(pt[0]),Rt,mt,xt,A?0:this.viewRotation_);t:if(i){const s=[];let n,r,o,a,h;if(w)for(n=0,r=i.length;n<r;++n){h=i[n],o=h[4],a=this.createLabel(o,R,"",w),_=h[2]+(pt[0]<0?-dt:dt),m=at*a.height+2*(.5-at)*dt*pt[1]/pt[0]-ut;const r=this.calculateImageOrLabelDimensions_(a.width,a.height,h[0],h[1],a.width,a.height,_,m,0,0,h[3],gt,!1,ft,!1,P);if(l&&l.collides(r.declutterBox))break t;s.push([t,e,a,r,1,null,null])}if(I)for(n=0,r=i.length;n<r;++n){h=i[n],o=h[4],a=this.createLabel(o,R,I,""),_=h[2],m=at*a.height-ut;const r=this.calculateImageOrLabelDimensions_(a.width,a.height,h[0],h[1],a.width,a.height,_,m,0,0,h[3],gt,!1,ft,!1,P);if(l&&l.collides(r.declutterBox))break t;s.push([t,e,a,r,1,null,null])}l&&l.load(s.map(zn));for(let t=0,e=s.length;t<e;++t)this.replayImageOrLabel_.apply(this,s[t])}}++d;break;case vn.END_GEOMETRY:if(void 0!==r){P=i[1];const t=r(P,B);if(t)return t}++d;break;case vn.FILL:D?E++:this.fill_(t),++d;break;case vn.MOVE_TO_LINE_TO:for(M=i[1],f=i[2],G=h[M],W=h[M+1],y=G+.5|0,v=W+.5|0,y===p&&v===x||(t.moveTo(G,W),p=y,x=v),M+=2;M<f;M+=2)G=h[M],W=h[M+1],y=G+.5|0,v=W+.5|0,M!=f-2&&y===p&&v===x||(t.lineTo(G,W),p=y,x=v);++d;break;case vn.SET_FILL_STYLE:T=i,this.alignFill_=i[2],E&&(this.fill_(t),E=0,b&&(t.stroke(),b=0)),t.fillStyle=i[1],++d;break;case vn.SET_STROKE_STYLE:k=i,b&&(t.stroke(),b=0),this.setStrokeStyle_(t,i),++d;break;case vn.STROKE:D?b++:t.stroke(),++d;break;default:++d}}E&&this.fill_(t),b&&t.stroke()}execute(t,e,i,s,n,r){this.viewRotation_=s,this.execute_(t,e,i,this.instructions,n,void 0,void 0,r)}executeHitDetection(t,e,i,s,n){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,s,n)}};const Un=["Polygon","Circle","LineString","Image","Text","Default"];const Kn={};var Hn=class{constructor(t,e,i,s,n,r){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=r,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(n)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t){for(const e in t){let i=this.executorsByZIndex_[e];void 0===i&&(i={},this.executorsByZIndex_[e]=i);const s=t[e];for(const t in s){const e=s[t];i[t]=new qn(this.resolution_,this.pixelRatio_,this.overlaps_,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let e=0,s=t.length;e<s;++e)if(t[e]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,r,o){const a=2*(n=Math.round(n))+1,l=ns(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=k(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;let u;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(u=[1/0,1/0,-1/0,-1/0],function(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}(u,t),Xt(u,e*(this.renderBuffer_+n),u));const d=function(t){if(void 0!==Kn[t])return Kn[t];const e=2*t+1,i=t*t,s=new Array(i+1);for(let n=0;n<=t;++n)for(let r=0;r<=t;++r){const o=n*n+r*r;if(o>i)break;let a=s[o];a||(a=[],s[o]=a),a.push(4*((t+n)*e+(t+r))+3),n>0&&a.push(4*((t-n)*e+(t+r))+3),r>0&&(a.push(4*((t+n)*e+(t-r))+3),n>0&&a.push(4*((t-n)*e+(t-r))+3))}const n=[];for(let t=0,e=s.length;t<e;++t)s[t]&&n.push(...s[t]);return Kn[t]=n,n}(n);let g;function f(t,e){const i=c.getImageData(0,0,a,a).data;for(let s=0,l=d.length;s<l;s++)if(i[d[s]]>0){if(!o||"Image"!==g&&"Text"!==g||o.includes(t)){const i=(d[s]-3)/4,o=n-i%a,l=n-(i/a|0),h=r(t,e,o*o+l*l);if(h)return h}c.clearRect(0,0,a,a);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);let m,p,x,y,v;for(_.sort(s),m=_.length-1;m>=0;--m){const t=_[m].toString();for(x=this.executorsByZIndex_[t],p=Un.length-1;p>=0;--p)if(g=Un[p],y=x[g],void 0!==y&&(v=y.executeHitDetection(c,l,i,f,u),v))return v}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],s=e[1],n=e[2],r=e[3],o=[i,s,i,r,n,r,n,s];return os(o,0,8,2,t,o),o}isEmpty(){return u(this.executorsByZIndex_)}execute(t,e,i,n,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);let h,c,u,d,g,f;for(l.sort(s),this.maxExtent_&&(t.save(),this.clip(t,i)),o=o||Un,a&&l.reverse(),h=0,c=l.length;h<c;++h){const s=l[h].toString();for(g=this.executorsByZIndex_[s],u=0,d=o.length;u<d;++u){f=g[o[u]],void 0!==f&&f.execute(t,e,i,n,r,a)}}this.maxExtent_&&t.restore()}};var Jn=class extends Sn{constructor(t,e,i,s,n,r,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=s,this.transformRotation_=s?function(t,e){const i=Math.pow(10,e);return Math.round(t*i)/i}(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=n,this.squaredTolerance_=r,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}drawImages_(t,e,i,s){if(!this.image_)return;const n=os(t,e,i,s,this.transform_,this.pixelCoordinates_),r=this.context_,o=this.tmpLocalTransform_,a=r.globalAlpha;1!=this.imageOpacity_&&(r.globalAlpha=a*this.imageOpacity_);let l=this.imageRotation_;0===this.transformRotation_&&(l-=this.viewRotation_),this.imageRotateWithView_&&(l+=this.viewRotation_);for(let t=0,e=n.length;t<e;t+=2){const e=n[t]-this.imageAnchorX_,i=n[t+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const t=e+this.imageAnchorX_,s=i+this.imageAnchorY_;ns(o,t,s,1,1,l,-t,-s),r.setTransform.apply(r,o),r.translate(t,s),r.scale(this.imageScale_[0],this.imageScale_[1]),r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),r.setTransform(1,0,0,1,0,0)}else r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,e,i,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(r.globalAlpha=a)}drawText_(t,e,i,s){if(!this.textState_||""===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const n=os(t,e,i,s,this.transform_,this.pixelCoordinates_),r=this.context_;let o=this.textRotation_;for(0===this.transformRotation_&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=s){const t=n[e]+this.textOffsetX_,i=n[e+1]+this.textOffsetY_;0!==o||1!=this.textScale_[0]||1!=this.textScale_[1]?(r.translate(t-this.textOffsetX_,i-this.textOffsetY_),r.rotate(o),r.translate(this.textOffsetX_,this.textOffsetY_),r.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&r.strokeText(this.text_,0,0),this.textFillState_&&r.fillText(this.text_,0,0),r.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&r.strokeText(this.text_,t,i),this.textFillState_&&r.fillText(this.text_,t,i))}}moveToLineTo_(t,e,i,s,n){const r=this.context_,o=os(t,e,i,s,this.transform_,this.pixelCoordinates_);r.moveTo(o[0],o[1]);let a=o.length;n&&(a-=2);for(let t=2;t<a;t+=2)r.lineTo(o[t],o[t+1]);return n&&r.closePath(),i}drawRings_(t,e,i,s){for(let n=0,r=i.length;n<r;++n)e=this.moveToLineTo_(t,e,i[n],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),oe(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=function(t,e,i){const s=t.getFlatCoordinates();if(!s)return null;const n=t.getStride();return os(s,0,s.length,n,e,i)}(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],s=e[3]-e[1],n=Math.sqrt(i*i+s*s),r=this.context_;r.beginPath(),r.arc(e[0],e[1],n,0,2*Math.PI),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let t=0,i=e.length;t<i;++t)this.drawGeometry(e[t])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),oe(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(oe(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();let s=0;const n=t.getEnds(),r=t.getStride();e.beginPath();for(let t=0,e=n.length;t<e;++t)s=this.moveToLineTo_(i,s,n[t],r,!1);e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoints();this.drawText_(e,0,e.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),oe(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),oe(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let s=0;const n=t.getEndss(),r=t.getStride();e.beginPath();for(let t=0,e=n.length;t<e;++t){const e=n[t];s=this.drawRings_(i,s,e,r)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),a(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,s=t.textAlign?t.textAlign:dt;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=s&&(i.textAlign=s,e.textAlign=s),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(t){const e=t.getColor();this.fillState_={fillStyle:it(e||at)}}else this.fillState_=null;if(e){const t=e.getColor(),i=e.getLineCap(),s=e.getLineDash(),n=e.getLineDashOffset(),r=e.getLineJoin(),o=e.getWidth(),a=e.getMiterLimit(),l=s||ht;this.strokeState_={lineCap:void 0!==i?i:lt,lineDash:1===this.pixelRatio_?l:l.map((t=>t*this.pixelRatio_)),lineDashOffset:(n||0)*this.pixelRatio_,lineJoin:void 0!==r?r:ct,lineWidth:(void 0!==o?o:1)*this.pixelRatio_,miterLimit:void 0!==a?a:10,strokeStyle:it(t||ut)}}else this.strokeState_=null}setImageStyle(t){let e;if(!t||!(e=t.getSize()))return void(this.image_=null);const i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const r=t.getScaleArray();this.imageScale_=[r[0]*this.pixelRatio_/i,r[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(t){const e=t.getFill();if(e){const t=e.getColor();this.textFillState_={fillStyle:it(t||at)}}else this.textFillState_=null;const i=t.getStroke();if(i){const t=i.getColor(),e=i.getLineCap(),s=i.getLineDash(),n=i.getLineDashOffset(),r=i.getLineJoin(),o=i.getWidth(),a=i.getMiterLimit();this.textStrokeState_={lineCap:void 0!==e?e:lt,lineDash:s||ht,lineDashOffset:n||0,lineJoin:void 0!==r?r:ct,lineWidth:void 0!==o?o:1,miterLimit:void 0!==a?a:10,strokeStyle:it(t||ut)}}else this.textStrokeState_=null;const s=t.getFont(),n=t.getOffsetX(),r=t.getOffsetY(),o=t.getRotateWithView(),a=t.getRotation(),l=t.getScaleArray(),h=t.getText(),c=t.getTextAlign(),u=t.getTextBaseline();this.textState_={font:void 0!==s?s:ot,textAlign:void 0!==c?c:dt,textBaseline:void 0!==u?u:gt},this.text_=void 0!==h?Array.isArray(h)?h.reduce(((t,e,i)=>t+(i%2?" ":e)),""):h:"",this.textOffsetX_=void 0!==n?this.pixelRatio_*n:0,this.textOffsetY_=void 0!==r?this.pixelRatio_*r:0,this.textRotateWithView_=void 0!==o&&o,this.textRotation_=void 0!==a?a:0,this.textScale_=[this.pixelRatio_*l[0],this.pixelRatio_*l[1]]}else this.text_=""}};const $n=.5;const Qn=.5,tr={Point:function(t,e,i,s,n){const r=i.getImage(),o=i.getText();let a;if(r){if(r.getImageState()!=D)return;let l=t;if(n){const h=r.getDeclutterMode();if("none"!==h)if(l=n,"obstacle"===h){const n=t.getBuilder(i.getZIndex(),"Image");n.setImageStyle(r,a),n.drawPoint(e,s)}else o&&o.getText()&&(a={})}const h=l.getBuilder(i.getZIndex(),"Image");h.setImageStyle(r,a),h.drawPoint(e,s)}if(o&&o.getText()){let r=t;n&&(r=n);const l=r.getBuilder(i.getZIndex(),"Text");l.setTextStyle(o,a),l.drawText(e,s)}},LineString:function(t,e,i,s,n){const r=i.getStroke();if(r){const n=t.getBuilder(i.getZIndex(),"LineString");n.setFillStrokeStyle(null,r),n.drawLineString(e,s)}const o=i.getText();if(o&&o.getText()){const r=(n||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(o),r.drawText(e,s)}},Polygon:function(t,e,i,s,n){const r=i.getFill(),o=i.getStroke();if(r||o){const n=t.getBuilder(i.getZIndex(),"Polygon");n.setFillStrokeStyle(r,o),n.drawPolygon(e,s)}const a=i.getText();if(a&&a.getText()){const r=(n||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(a),r.drawText(e,s)}},MultiPoint:function(t,e,i,s,n){const r=i.getImage(),o=i.getText();let a;if(r){if(r.getImageState()!=D)return;let l=t;if(n){const h=r.getDeclutterMode();if("none"!==h)if(l=n,"obstacle"===h){const n=t.getBuilder(i.getZIndex(),"Image");n.setImageStyle(r,a),n.drawMultiPoint(e,s)}else o&&o.getText()&&(a={})}const h=l.getBuilder(i.getZIndex(),"Image");h.setImageStyle(r,a),h.drawMultiPoint(e,s)}if(o&&o.getText()){let r=t;n&&(r=n);const l=r.getBuilder(i.getZIndex(),"Text");l.setTextStyle(o,a),l.drawText(e,s)}},MultiLineString:function(t,e,i,s,n){const r=i.getStroke();if(r){const n=t.getBuilder(i.getZIndex(),"LineString");n.setFillStrokeStyle(null,r),n.drawMultiLineString(e,s)}const o=i.getText();if(o&&o.getText()){const r=(n||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(o),r.drawText(e,s)}},MultiPolygon:function(t,e,i,s,n){const r=i.getFill(),o=i.getStroke();if(o||r){const n=t.getBuilder(i.getZIndex(),"Polygon");n.setFillStrokeStyle(r,o),n.drawMultiPolygon(e,s)}const a=i.getText();if(a&&a.getText()){const r=(n||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(a),r.drawText(e,s)}},GeometryCollection:function(t,e,i,s,n){const r=e.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o){(0,tr[r[o].getType()])(t,r[o],i,s,n)}},Circle:function(t,e,i,s,n){const r=i.getFill(),o=i.getStroke();if(r||o){const n=t.getBuilder(i.getZIndex(),"Circle");n.setFillStrokeStyle(r,o),n.drawCircle(e,s)}const a=i.getText();if(a&&a.getText()){const r=(n||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(a),r.drawText(e,s)}}};function er(t,e){return parseInt(R(t),10)-parseInt(R(e),10)}function ir(t,e){return Qn*t/e}function sr(t,e,i,s,n,r,o){let a=!1;const l=i.getImage();if(l){const t=l.getImageState();t==D||t==P?l.unlistenImageChange(n):(t==A&&l.load(),l.listenImageChange(n),a=!0)}return function(t,e,i,s,n,r){const o=i.getGeometryFunction()(e);if(!o)return;const a=o.simplifyTransformed(s,n),l=i.getRenderer();if(l)nr(t,a,i,e);else{(0,tr[a.getType()])(t,a,i,e,r)}}(t,e,i,s,r,o),a}function nr(t,e,i,s){if("GeometryCollection"==e.getType()){const n=e.getGeometries();for(let e=0,r=n.length;e<r;++e)nr(t,n[e],i,s);return}t.getBuilder(i.getZIndex(),"Default").drawCustom(e,s,i.getRenderer(),i.getHitDetectionRenderer())}var rr=class extends Dn{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const s=e.extent,n=e.viewState,r=n.center,o=n.resolution,a=n.projection,l=n.rotation,h=a.getExtent(),c=this.getLayer().getSource(),u=e.pixelRatio,d=e.viewHints,g=!(d[oi]||d[ai]),f=this.compositionContext_,_=Math.round(e.size[0]*u),m=Math.round(e.size[1]*u),p=c.getWrapX()&&a.canWrapX(),x=p?re(h):null,y=p?Math.ceil((s[2]-h[2])/x)+1:1;let v=p?Math.floor((s[0]-h[0])/x):0;do{const e=this.getRenderTransform(r,o,l,u,_,m,v*x);t.execute(f,1,e,l,g,void 0,i)}while(++v<y)}setupCompositionContext_(){if(1!==this.opacity_){const t=k(this.context.canvas.width,this.context.canvas.height,An);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(1!==this.opacity_){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,function(t){const e=t.canvas;e.width=1,e.height=1,t.clearRect(0,0,1,1)}(this.compositionContext_),An.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const i=t.pixelRatio,s=t.layerStatesArray[t.layerIndex];!function(t,e,i){(function(t,e,i,s,n,r,o){t[0]=e,t[1]=i,t[2]=s,t[3]=n,t[4]=r,t[5]=o})(t,e,0,0,i,0,0)}(this.pixelTransform,1/i,1/i),function(t,e){const i=(s=e)[0]*s[3]-s[1]*s[2];var s;z(0!==i,32);const n=e[0],r=e[1],o=e[2],a=e[3],l=e[4],h=e[5];t[0]=a/i,t[1]=-r/i,t[2]=-o/i,t[3]=n/i,t[4]=(o*h-a*l)/i,t[5]=-(n*h-r*l)/i}(this.inversePixelTransform,this.pixelTransform);const n=function(t){const e="matrix("+t.join(", ")+")";if(b)return e;const i=rs||(rs=document.createElement("div"));return i.style.transform=e,i.style.transform}(this.pixelTransform);this.useContainer(e,n,this.getBackground(t));const r=this.context,o=r.canvas,a=this.replayGroup_,l=this.declutterExecutorGroup;let h=a&&!a.isEmpty()||l&&!l.isEmpty();if(!h){if(!(this.getLayer().hasListener(si)||this.getLayer().hasListener(ni)))return null}const c=Math.round(t.size[0]*i),u=Math.round(t.size[1]*i);o.width!=c||o.height!=u?(o.width=c,o.height=u,o.style.transform!==n&&(o.style.transform=n)):this.containerReused||r.clearRect(0,0,c,u),this.preRender(r,t);const d=t.viewState;d.projection,this.opacity_=s.opacity,this.setupCompositionContext_();let g=!1;if(h&&s.extent&&this.clipping){const e=zi(s.extent);h=oe(e,t.extent),g=h&&!jt(e,t.extent),g&&this.clipUnrotated(this.compositionContext_,t,e)}return h&&this.renderWorlds(a,t),g&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(r,t),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise((e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const t=[this.context.canvas.width,this.context.canvas.height];ss(this.pixelTransform,t);const e=this.renderedCenter_,i=this.renderedResolution_,n=this.renderedRotation_,r=this.renderedProjection_,o=this.wrappedRenderedExtent_,a=this.getLayer(),l=[],h=t[0]*$n,c=t[1]*$n;l.push(this.getRenderTransform(e,i,n,$n,h,c,0).slice());const u=a.getSource(),d=r.getExtent();if(u.getWrapX()&&r.canWrapX()&&!jt(d,o)){let t=o[0];const s=re(d);let r,a=0;for(;t<d[0];)--a,r=s*a,l.push(this.getRenderTransform(e,i,n,$n,h,c,r).slice()),t+=s;for(a=0,t=o[2];t>d[2];)++a,r=s*a,l.push(this.getRenderTransform(e,i,n,$n,h,c,r).slice()),t-=s}this.hitDetectionImageData_=function(t,e,i,n,r,o,a){const l=k(t[0]*$n,t[1]*$n);l.imageSmoothingEnabled=!1;const h=l.canvas,c=new Jn(l,$n,r,null,a),u=i.length,d=Math.floor(16777215/u),g={};for(let t=1;t<=u;++t){const e=i[t-1],s=e.getStyleFunction()||n;if(!s)continue;let a=s(e,o);if(!a)continue;Array.isArray(a)||(a=[a]);const l=(t*d).toString(16).padStart(7,"#00000");for(let t=0,i=a.length;t<i;++t){const i=a[t],s=i.getGeometryFunction()(e);if(!s||!oe(r,s.getExtent()))continue;const n=i.clone(),o=n.getFill();o&&o.setColor(l);const h=n.getStroke();h&&(h.setColor(l),h.setLineDash(null)),n.setText(void 0);const c=i.getImage();if(c){const t=c.getImageSize();if(!t)continue;const e=k(t[0],t[1],void 0,{alpha:!1}),i=e.canvas;e.fillStyle=l,e.fillRect(0,0,i.width,i.height),n.setImage(new fe({img:i,imgSize:t,anchor:c.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:c.getOrigin(),opacity:1,size:c.getSize(),scale:c.getScale(),rotation:c.getRotation(),rotateWithView:c.getRotateWithView()}))}const u=n.getZIndex()||0;let d=g[u];d||(d={},g[u]=d,d.Polygon=[],d.Circle=[],d.LineString=[],d.Point=[]);const f=s.getType();if("GeometryCollection"===f){const t=s.getGeometriesArrayRecursive();for(let e=0,i=t.length;e<i;++e){const i=t[e];d[i.getType().replace("Multi","")].push(i,n)}}else d[f.replace("Multi","")].push(s,n)}}const f=Object.keys(g).map(Number).sort(s);for(let t=0,i=f.length;t<i;++t){const i=g[f[t]];for(const t in i){const s=i[t];for(let t=0,i=s.length;t<i;t+=2){c.setStyle(s[t+1]);for(let i=0,n=e.length;i<n;++i)c.setTransform(e[i]),c.drawGeometry(s[t])}}}return l.getImageData(0,0,h.width,h.height)}(t,l,this.renderedFeatures_,a.getStyleFunction(),o,i,n)}e(function(t,e,i){const s=[];if(i){const n=Math.floor(Math.round(t[0])*$n),r=Math.floor(Math.round(t[1])*$n),o=4*(j(n,0,i.width-1)+j(r,0,i.height-1)*i.width),a=i.data[o],l=i.data[o+1],h=i.data[o+2]+256*(l+256*a),c=Math.floor(16777215/e.length);h&&h%c==0&&s.push(e[h/c-1])}return s}(t,this.renderedFeatures_,this.hitDetectionImageData_))}))}forEachFeatureAtCoordinate(t,e,i,s,n){if(!this.replayGroup_)return;const r=e.viewState.resolution,o=e.viewState.rotation,a=this.getLayer(),l={},h=function(t,e,i){const r=R(t),o=l[r];if(o){if(!0!==o&&i<o.distanceSq){if(0===i)return l[r]=!0,n.splice(n.lastIndexOf(o),1),s(t,a,e);o.geometry=e,o.distanceSq=i}}else{if(0===i)return l[r]=!0,s(t,a,e);n.push(l[r]={feature:t,layer:a,geometry:e,distanceSq:i,callback:s})}};let c;const u=[this.replayGroup_];return this.declutterExecutorGroup&&u.push(this.declutterExecutorGroup),u.some((s=>c=s.forEachFeatureAtCoordinate(t,r,o,i,h,s===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map((t=>t.value)):null))),c}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const s=t.viewHints[oi],n=t.viewHints[ai],r=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(this.ready&&!r&&s||!o&&n)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,u=h.resolution,d=t.pixelRatio,g=e.getRevision(),f=e.getRenderBuffer();let _=e.getRenderOrder();void 0===_&&(_=er);const m=h.center.slice(),p=Xt(l,f*u),x=p.slice(),y=[p.slice()],v=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!jt(v,t.extent)){const t=re(v),e=Math.max(re(p)/2,t);p[0]=v[0]-e,p[2]=v[2]+e,bi(m,c);const i=he(y[0],c);i[0]<v[0]&&i[2]<v[2]?y.push([i[0]+t,i[1],i[2]+t,i[3]]):i[0]>v[0]&&i[2]>v[2]&&y.push([i[0]-t,i[1],i[2]-t,i[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==g&&this.renderedRenderOrder_==_&&jt(this.wrappedRenderedExtent_,p))return a(this.renderedExtent_,x)||(this.hitDetectionImageData_=null,this.renderedExtent_=x),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const S=new kn(ir(u,d),p,u,d);let C;this.getLayer().getDeclutter()&&(C=new kn(ir(u,d),p,u,d));for(let t=0,e=y.length;t<e;++t)i.loadFeatures(y[t],u,c);const R=function(t,e){const i=ir(t,e);return i*i}(u,d);let w=!0;const I=t=>{let i;const s=t.getStyleFunction()||e.getStyleFunction();if(s&&(i=s(t,u)),i){const e=this.renderFeature(t,R,i,S,undefined,C);w=w&&!e}},M=Yi(p),E=i.getFeaturesInExtent(M);_&&E.sort(_);for(let t=0,e=E.length;t<e;++t)I(E[t]);this.renderedFeatures_=E,this.ready=w;const b=S.finish(),T=new Hn(p,u,d,i.getOverlaps(),b,e.getRenderBuffer());return C&&(this.declutterExecutorGroup=new Hn(p,u,d,i.getOverlaps(),C.finish(),e.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=g,this.renderedRenderOrder_=_,this.renderedExtent_=x,this.wrappedRenderedExtent_=p,this.renderedCenter_=m,this.renderedProjection_=c,this.replayGroup_=T,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,s,n,r){if(!i)return!1;let o=!1;if(Array.isArray(i))for(let a=0,l=i.length;a<l;++a)o=sr(s,t,i[a],e,this.boundHandleStyleImageChange_,n,r)||o;else o=sr(s,t,i,e,this.boundHandleStyleImageChange_,n,r);return o}};var or=class extends fn{constructor(t){super(t)}createRenderer(){return new rr(this)}},ar="add",lr="remove";const hr="length";class cr extends t{constructor(t,e,i){super(t),this.element=e,this.index=i}}var ur=class extends I{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let t=0,e=this.array_.length;t<e;++t)this.assertUnique_(this.array_[t],t);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,s=e.length;i<s;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(hr)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new cr(ar,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,s=e.length;i<s;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new cr(lr,e,t)),e}setAt(t,e){if(t>=this.getLength())return void this.insertAt(t,e);if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const i=this.array_[t];this.array_[t]=e,this.dispatchEvent(new cr(lr,i,t)),this.dispatchEvent(new cr(ar,e,t))}updateLength_(){this.set(hr,this.array_.length)}assertUnique_(t,e){for(let i=0,s=this.array_.length;i<s;++i)if(this.array_[i]===t&&i!==e)throw new Y(58)}};var dr=class{constructor(t){this.rbush_=new Vs(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[R(e)]=i}load(t,e){const i=new Array(e.length);for(let s=0,n=e.length;s<n;s++){const n=t[s],r=e[s],o={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3],value:r};i[s]=o,this.items_[R(r)]=o}this.rbush_.load(i)}remove(t){const e=R(t),i=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(i)}update(t,e){const i=this.items_[R(e)];Kt([i.minX,i.minY,i.maxX,i.maxY],t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map((function(t){return t.value}))}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map((function(t){return t.value}))}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let s=0,n=t.length;s<n;s++)if(i=e(t[s]),i)return i;return i}isEmpty(){return u(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return qt(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}};function gr(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}var fr=class extends I{constructor(t){super(),this.projection=Di(t.projection),this.attributions_=gr(t.attributions),this.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,this.loading=!1,this.state_=void 0!==t.state?t.state:"ready",this.wrapX_=void 0!==t.wrapX&&t.wrapX,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise((function(t,i){e.viewResolver=t,e.viewRejector=i}))}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=gr(t),this.changed()}setState(t){this.state_=t,this.changed()}},_r="addfeature",mr="changefeature",pr="clear",xr="removefeature",yr="featuresloadstart",vr="featuresloadend",Sr="featuresloaderror";function Cr(t,e){return[[-1/0,-1/0,1/0,1/0]]}let Rr=!1;function wr(t,e){return function(i,s,n,r,o){const a=this;!function(t,e,i,s,n,r,o){const a=new XMLHttpRequest;a.open("GET","function"==typeof t?t(i,s,n):t,!0),"arraybuffer"==e.getType()&&(a.responseType="arraybuffer"),a.withCredentials=Rr,a.onload=function(t){if(!a.status||a.status>=200&&a.status<300){const t=e.getType();let s;"json"==t||"text"==t?s=a.responseText:"xml"==t?(s=a.responseXML,s||(s=(new DOMParser).parseFromString(a.responseText,"application/xml"))):"arraybuffer"==t&&(s=a.response),s?r(e.readFeatures(s,{extent:i,featureProjection:n}),e.readProjection(s)):o()}else o()},a.onerror=o,a.send()}(t,e,i,s,n,(function(t,e){a.addFeatures(t),void 0!==r&&r(t)}),o||h)}}class Ir extends t{constructor(t,e,i){super(t),this.feature=e,this.features=i}}var Mr=class extends fr{constructor(t){super({attributions:(t=t||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===t.wrapX||t.wrapX}),this.on,this.once,this.un,this.loader_=h,this.format_=t.format,this.overlaps_=void 0===t.overlaps||t.overlaps,this.url_=t.url,void 0!==t.loader?this.loader_=t.loader:void 0!==this.url_&&(z(this.format_,7),this.loader_=wr(this.url_,this.format_)),this.strategy_=void 0!==t.strategy?t.strategy:Cr;const e=void 0===t.useSpatialIndex||t.useSpatialIndex;let i,s;this.featuresRtree_=e?new dr:null,this.loadedExtentsRtree_=new dr,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(t.features)?s=t.features:t.features&&(i=t.features,s=i.getArray()),e||void 0!==i||(i=new ur(s)),void 0!==s&&this.addFeaturesInternal(s),void 0!==i&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=R(t);if(!this.addToIndex_(e,t))return void(this.featuresCollection_&&this.featuresCollection_.remove(t));this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const e=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(e,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Ir(_r,t))}setupChangeEvents_(t,i){this.featureChangeKeys_[t]=[m(i,g,this.handleFeatureChange_,this),m(i,e,this.handleFeatureChange_,this)]}addToIndex_(t,e){let i=!0;const s=e.getId();return void 0!==s&&(s.toString()in this.idIndex_?i=!1:this.idIndex_[s.toString()]=e),i&&(z(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],s=[];for(let e=0,s=t.length;e<s;e++){const s=t[e],n=R(s);this.addToIndex_(n,s)&&i.push(s)}for(let t=0,n=i.length;t<n;t++){const n=i[t],r=R(n);this.setupChangeEvents_(r,n);const o=n.getGeometry();if(o){const t=o.getExtent();e.push(t),s.push(n)}else this.nullGeometryFeatures_[r]=n}if(this.featuresRtree_&&this.featuresRtree_.load(e,s),this.hasListener(_r))for(let t=0,e=i.length;t<e;t++)this.dispatchEvent(new Ir(_r,i[t]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(_r,(function(i){e||(e=!0,t.push(i.feature),e=!1)})),this.addEventListener(xr,(function(i){e||(e=!0,t.remove(i.feature),e=!1)})),t.addEventListener(ar,(t=>{e||(e=!0,this.addFeature(t.element),e=!1)})),t.addEventListener(lr,(t=>{e||(e=!0,this.removeFeature(t.element),e=!1)})),this.featuresCollection_=t}clear(t){if(t){for(const t in this.featureChangeKeys_){this.featureChangeKeys_[t].forEach(x)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const t=t=>{this.removeFeatureInternal(t)};this.featuresRtree_.forEach(t);for(const t in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[t])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Ir(pr);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,(function(i){if(i.getGeometry().intersectsCoordinate(t))return e(i)}))}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,(function(i){if(i.getGeometry().intersectsExtent(t)){const t=e(i);if(t)return t}}))}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),u(this.nullGeometryFeatures_)||o(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,(function(t){e.push(t)})),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const i=function(t,e){if(e.canWrapX()){const i=e.getExtent();if(!isFinite(t[0])||!isFinite(t[2]))return[[i[0],t[1],i[2],t[3]]];he(t,e);const s=re(i);if(re(t)>s)return[[i[0],t[1],i[2],t[3]]];if(t[0]<i[0])return[[t[0]+s,t[1],i[2],t[3]],[i[0],t[1],t[2],t[3]]];if(t[2]>i[2])return[[t[0],t[1],i[2],t[3]],[i[0],t[1],t[2]-s,t[3]]]}return[t]}(t,e);return[].concat(...i.map((t=>this.featuresRtree_.getInExtent(t))))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],s=t[1];let n=null;const r=[NaN,NaN];let o=1/0;const a=[-1/0,-1/0,1/0,1/0];return e=e||l,this.featuresRtree_.forEachInExtent(a,(function(t){if(e(t)){const e=t.getGeometry(),l=o;if(o=e.closestPointXY(i,s,r,o),o<l){n=t;const e=Math.sqrt(o);a[0]=i-e,a[1]=s-e,a[2]=i+e,a[3]=s+e}}})),n}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return void 0!==e?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return void 0!==e?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=R(e),s=e.getGeometry();if(s){const t=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(t,e)):this.featuresRtree_&&this.featuresRtree_.update(t,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);const n=e.getId();if(void 0!==n){const t=n.toString();this.idIndex_[t]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[t]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new Ir(mr,e))}hasFeature(t){const e=t.getId();return void 0!==e?e in this.idIndex_:R(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&u(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(t,e,i){const s=this.loadedExtentsRtree_,n=this.strategy_(t,e,i);for(let t=0,r=n.length;t<r;++t){const r=n[t];s.forEachInExtent(r,(function(t){return jt(t.extent,r)}))||(++this.loadingExtentsCount_,this.dispatchEvent(new Ir(yr)),this.loader_.call(this,r,e,i,(t=>{--this.loadingExtentsCount_,this.dispatchEvent(new Ir(vr,void 0,t))}),(()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Ir(Sr))})),s.insert(r,{extent:r.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,(function(e){if(Kt(e.extent,t))return i=e,!0})),i&&e.remove(i)}removeFeature(t){if(!t)return;const e=R(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=R(t),i=this.featureChangeKeys_[e];if(!i)return;i.forEach(x),delete this.featureChangeKeys_[e];const s=t.getId();return void 0!==s&&delete this.idIndex_[s.toString()],delete this.uidIndex_[e],this.dispatchEvent(new Ir(xr,t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e}setLoader(t){this.loader_=t}setUrl(t){z(this.format_,7),this.url_=t,this.setLoader(wr(t,this.format_))}};class Er extends I{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if("function"==typeof t.getSimplifiedGeometry){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Er(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(x(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=m(t,g,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?function(t){if("function"==typeof t)return t;let e;if(Array.isArray(t))e=t;else{z("function"==typeof t.getZIndex,41);e=[t]}return function(){return e}}(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}var br=Er;class Tr{constructor(){this.settings={url:"https://photon.komoot.io/api/",params:{q:"",limit:10,lang:"en"},langs:["de","it","fr","en"]}}getParameters(t){return t.lang=t.lang.toLowerCase(),{url:this.settings.url,params:{q:t.query,limit:t.limit||this.settings.params.limit,lang:this.settings.langs.includes(t.lang)?t.lang:this.settings.params.lang}}}handleResponse(t){return 0===t.features.length?[]:t.features.map((t=>({lon:t.geometry.coordinates[0],lat:t.geometry.coordinates[1],address:{name:t.properties.name,postcode:t.properties.postcode,city:t.properties.city,state:t.properties.state,country:t.properties.country},original:{formatted:t.properties.name,details:t.properties}})))}}class kr{constructor(){this.settings={url:"https://nominatim.openstreetmap.org/search",params:{q:"",format:"json",addressdetails:1,limit:10,countrycodes:"","accept-language":"en-US"}}}getParameters(t){return{url:this.settings.url,params:{q:t.query,format:this.settings.params.format,addressdetails:this.settings.params.addressdetails,limit:t.limit||this.settings.params.limit,countrycodes:t.countrycodes||this.settings.params.countrycodes,"accept-language":t.lang||this.settings.params["accept-language"]}}}handleResponse(t){return 0===t.length?[]:t.map((t=>({lon:t.lon,lat:t.lat,bbox:t.boundingbox,address:{name:t.display_name,road:t.address.road||"",houseNumber:t.address.house_number||"",postcode:t.address.postcode,city:t.address.city||t.address.town,state:t.address.state,country:t.address.country},original:{formatted:t.display_name,details:t.address}})))}}class Lr{constructor(){this.settings={url:"https://open.mapquestapi.com/nominatim/v1/search.php",params:{q:"",key:"",format:"json",addressdetails:1,limit:10,countrycodes:"","accept-language":"en-US"}}}getParameters(t){return{url:this.settings.url,params:{q:t.query,key:t.key,format:"json",addressdetails:1,limit:t.limit||this.settings.params.limit,countrycodes:t.countrycodes||this.settings.params.countrycodes,"accept-language":t.lang||this.settings.params["accept-language"]}}}handleResponse(t){return 0===t.length?[]:t.map((t=>({lon:t.lon,lat:t.lat,address:{name:t.address.neighbourhood||"",road:t.address.road||"",postcode:t.address.postcode,city:t.address.city||t.address.town,state:t.address.state,country:t.address.country},original:{formatted:t.display_name,details:t.address}})))}}class Fr{constructor(){this.settings={url:"https://dev.virtualearth.net/REST/v1/Locations",callbackName:"jsonp",params:{query:"",key:"",includeNeighborhood:0,maxResults:10}}}getParameters(t){return{url:this.settings.url,callbackName:this.settings.callbackName,params:{query:t.query,key:t.key,includeNeighborhood:t.includeNeighborhood||this.settings.params.includeNeighborhood,maxResults:t.maxResults||this.settings.params.maxResults}}}handleResponse(t){const{resources:e}=t.resourceSets[0];return 0===e.length?[]:e.map((t=>({lon:t.point.coordinates[1],lat:t.point.coordinates[0],address:{name:t.name},original:{formatted:t.address.formattedAddress,details:t.address}})))}}class Ar{constructor(){this.settings={url:"https://api.opencagedata.com/geocode/v1/json?",params:{q:"",key:"",limit:10,countrycode:"",pretty:1,no_annotations:1}}}getParameters(t){return{url:this.settings.url,params:{q:t.query,key:t.key,limit:t.limit||this.settings.params.limit,countrycode:t.countrycodes||this.settings.params.countrycodes}}}handleResponse(t){return 0===t.results.length?[]:t.results.map((t=>({lon:t.geometry.lng,lat:t.geometry.lat,address:{name:t.components.house_number||"",road:t.components.road||"",postcode:t.components.postcode,city:t.components.city||t.components.town,state:t.components.state,country:t.components.country},original:{formatted:t.formatted,details:t.components}})))}}function Or(t){return new Promise(((e,i)=>{const s=function(t,e){e&&"object"==typeof e&&(t+=(/\?/u.test(t)?"&":"?")+Dr(e));return t}(t.url,t.data),n={method:"GET",mode:"cors",credentials:"same-origin"};t.jsonp?function(t,e,i){const{head:s}=document,n=document.createElement("script"),r=`f${Math.round(Math.random()*Date.now())}`;n.setAttribute("src",`${t+(t.indexOf("?")>0?"&":"?")+e}=${r}`),window[r]=t=>{window[r]=void 0,setTimeout((()=>s.removeChild(n)),0),i(t)},s.append(n)}(s,t.callbackName,e):fetch(s,n).then((t=>t.json())).then(e).catch(i)}))}function Dr(t){return Object.keys(t).reduce(((e,i)=>(e.push("object"==typeof t[i]?Dr(t[i]):`${encodeURIComponent(i)}=${encodeURIComponent(t[i])}`),e)),[]).join("&")}const Pr=Se.cssClasses;class Gr{constructor(t,e){this.Base=t,this.layerName=Oe("geocoder-layer-"),this.layer=new or({name:this.layerName,source:new Mr}),this.options=t.options,this.options.provider="string"==typeof this.options.provider?this.options.provider.toLowerCase():this.options.provider,this.provider=this.newProvider(),this.els=e,this.lastQuery="",this.container=this.els.container,this.registeredListeners={mapClick:!1},this.setListeners()}setListeners(){let t,e;const i=t=>{t.stopPropagation(),We(this.els.control,Pr.glass.expanded)?this.collapse():this.expand()};this.els.input.addEventListener("keypress",(t=>{const e=t.target.value.trim();(t.key?"Enter"===t.key:t.which?13===t.which:!!t.keyCode&&13===t.keyCode)&&(t.preventDefault(),this.query(e))}),!1),this.els.input.addEventListener("click",(t=>t.stopPropagation()),!1),this.els.input.addEventListener("input",(i=>{const s=i.target.value.trim();0!==s.length?Ge(this.els.reset,Pr.hidden):Pe(this.els.reset,Pr.hidden),this.options.autoComplete&&s!==e&&(e=s,t&&clearTimeout(t),t=setTimeout((()=>{s.length>=this.options.autoCompleteMinLength&&this.query(s)}),this.options.autoCompleteTimeout))}),!1),this.els.reset.addEventListener("click",(t=>{this.els.input.focus(),this.els.input.value="",this.lastQuery="",Pe(this.els.reset,Pr.hidden),this.clearResults()}),!1),this.options.targetType===Ie&&this.els.button.addEventListener("click",i,!1)}query(t){this.provider||(this.provider=this.newProvider());const e=this.provider.getParameters({query:t,key:this.options.key,lang:this.options.lang,countrycodes:this.options.countrycodes,limit:this.options.limit});if(this.lastQuery===t&&this.els.result.firstChild)return;this.lastQuery=t,this.clearResults(),Pe(this.els.reset,Pr.spin);const i={url:e.url,data:e.params};e.callbackName&&(i.jsonp=!0,i.callbackName=e.callbackName),Or(i).then((t=>{this.options.debug&&console.info(t),Ge(this.els.reset,Pr.spin);const e=this.provider.handleResponse(t);e&&(this.createList(e),this.listenMapClick())})).catch((t=>{Ge(this.els.reset,Pr.spin);const e=Ne("li","<h5>Error! No internet connection?</h5>");this.els.result.append(e)}))}createList(t){const e=this.els.result;t.forEach((t=>{let i;if(this.options.provider===Ee)i=`<span class="${Pr.road}">${t.address.name}</span>`;else i=this.addressTemplate(t.address);const s=Ne("li",`<a href="#">${i}</a>`);s.addEventListener("click",(e=>{e.preventDefault(),this.chosen(t,i,t.address,t.original)}),!1),e.append(s)}))}chosen(t,e,i,s){const n=this.Base.getMap(),r=[Number.parseFloat(t.lon),Number.parseFloat(t.lat)],o=n.getView().getProjection(),a=(l=r,Bi("EPSG:4326",o)(l,void 0,l.length));var l;let{bbox:h}=t;h&&(h=function(t,e,i,s){return le(t,Bi(e,i),void 0,s)}([h[2],h[1],h[3],h[0]],"EPSG:4326",o));const c={formatted:e,details:i,original:s};if(!1===this.options.keepOpen&&this.clearResults(!0),!0===this.options.preventDefault)this.Base.dispatchEvent({type:Ce,address:c,coordinate:a,bbox:h,place:t});else{h?n.getView().fit(h,{duration:500}):function(t,e,i=500,s=2.388657133911758){t.getView().animate({duration:i,resolution:s},{duration:i,center:e})}(n,a);const e=this.createFeature(a,c);this.Base.dispatchEvent({type:Ce,address:c,feature:e,coordinate:a,bbox:h,place:t})}}createFeature(t){const e=new br(new Is(t));return this.addLayer(),e.setStyle(this.options.featureStyle),e.setId(Oe("geocoder-ft-")),this.getSource().addFeature(e),e}addressTemplate(t){const e=[];return t.name&&e.push(['<span class="',Pr.road,'">{name}</span>'].join("")),(t.road||t.building||t.house_number)&&e.push(['<span class="',Pr.road,'">{building} {road} {house_number}</span>'].join("")),(t.city||t.town||t.village)&&e.push(['<span class="',Pr.city,'">{postcode} {city} {town} {village}</span>'].join("")),(t.state||t.country)&&e.push(['<span class="',Pr.country,'">{state} {country}</span>'].join("")),Be(e.join("<br>"),t)}newProvider(){switch(this.options.provider){case Ee:return new kr;case be:return new Lr;case Te:return new Tr;case ke:return new Fr;case Le:return new Ar;default:return this.options.provider}}expand(){Ge(this.els.input,Pr.spin),Pe(this.els.control,Pr.glass.expanded),window.setTimeout((()=>this.els.input.focus()),100),this.listenMapClick()}collapse(){this.els.input.value="",this.els.input.blur(),Pe(this.els.reset,Pr.hidden),Ge(this.els.control,Pr.glass.expanded),this.clearResults()}listenMapClick(){if(this.registeredListeners.mapClick)return;const t=this,e=this.Base.getMap().getTargetElement();this.registeredListeners.mapClick=!0,e.addEventListener("click",{handleEvent(i){t.clearResults(!0),e.removeEventListener(i.type,this,!1),t.registeredListeners.mapClick=!1}},!1)}clearResults(t){t&&this.options.targetType===Ie?this.collapse():function(t){for(;t.firstChild;)t.firstChild.remove()}(this.els.result)}getSource(){return this.layer.getSource()}addLayer(){let t=!1;const e=this.Base.getMap();e.getLayers().forEach((e=>{e===this.layer&&(t=!0)})),t||e.addLayer(this.layer)}}class Wr extends F{constructor(t=Re,e={}){if(!(this instanceof Wr))return new Wr;let i;Ae("string"==typeof t,"@param `type` should be string!"),Ae(t===Re||t===we,`@param 'type' should be '${Re}'\n      or '${we}'!`),Ae("object"==typeof e,"@param `options` should be object!"),Fe.featureStyle=[new Gt({image:new fe({scale:.7,src:"//cdn.rawgit.com/jonataswalker/map-utils/master/images/marker.png"})})],this.options=function(t,e){const i={};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t]);return i}(Fe,e),this.container=void 0;const s=new Ve(this);t===Re&&(this.container=s.els.container,i=new Gr(this,s.els),this.layer=i.layer),super({element:this.container})}getLayer(){return this.layer}getSource(){return this.getLayer().getSource()}setProvider(t){this.options.provider=t}setProviderKey(t){this.options.key=t}}return Wr}));
//# sourceMappingURL=ol-geocoder.js.map
